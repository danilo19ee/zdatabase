+++++++++++++++++++++++++++++++++++++
+   HADOOP MULTI-NODE CLUSTER OL7   +
+++++++++++++++++++++++++++++++++++++

#CREATE AND INSTALL CLUSTER HADOOP ON VIRTUALBOX (ORACLE LINUX 7)
#GUIDE : Hadoop Compatible Framework For Discovering Network Topology And Detecting Hardware Failures
#REFERENCE: http://www.stratapps.net/hadoop-multinode-installation-guide.php
#REFERENCE: https://hadoopabcd.wordpress.com/2015/01/03/setting-up-hadoop-multi-node-cluster-on-amazon-ec2-2/

#CONFIGURE IN ALL HADOOP MACHINES
#NETWORK 
vi /etc/hosts
192.168.56.119  hadoopmaster1
192.168.56.120  hadoopslave1
192.168.56.121  hadoopslave2

#DISABLE SELINUX AND STOP FIREWALL IN ALL NODES 
sed -i 's/SELINUX=.*/SELINUX=disabled/' /etc/sysconfig/selinux && setenforce 0
systemctl stop firewalld && systemctl disable firewalld

#ADD REPOSITORIES TO YUM 
vi /etc/yum.repos.d/oracle-linux-ol7.repo

[ol7_optional_developer]
name=Developer Preview of Oracle Linux $releasever Optional ($basearch)
baseurl=https://yum.oracle.com/repo/OracleLinux/OL7/optional/developer/$basearch/
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-oracle
gpgcheck=1
enabled=1

[ol7_developer_EPEL]
name=Oracle Linux $releasever Development Packages ($basearch)
baseurl=https://yum.oracle.com/repo/OracleLinux/OL7/developer_EPEL/$basearch/
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-oracle
gpgcheck=1
enabled=1

#LIST REPOSITORIES LIST
yum repolist

#INSTALL PRE-REQUIRES PACKAGES
yum install pdsh.x86_64 -y
yum install java-1.8.0-openjdk.x86_64 -y 

#CHECK JAVA VERSION
java -version

#CONFIGURE ENVORIMENTS VARIABLES
vi .bashrc
export PDSH_RCMD_TYPE=ssh

#GERENATE SSH KEY
ssh-keygen -t rsa
cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys

#VALIDADE LOCAL ACCESS
ssh localhost

#DOWNLOAD HADOOP 3.2
wget https://mirrors.sonic.net/apache/hadoop/common/hadoop-3.2.1/hadoop-3.2.1.tar.gz

#EXTRACT SOFTWARE
tar xzf hadoop-3.2.1.tar.gz

#RENAME FOLDER
mv hadoop-3.2.1 hadoop

#CONFIGURE JAVA_HOME ON HADOOP-ENV.SH
vi ~/hadoop/etc/hadoop/hadoop-env.sh
export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.242.b08-0.el7_7.x86_64/jre

#MOVE HADOOP FOR /USR/LOCAL
mv hadoop /usr/local/hadoop

#ADD VARIABLES /ETC/ENVIRONMENT
vi /etc/environment
PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/hadoop/bin:/usr/local/hadoop/sbin"
JAVA_HOME="/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.242.b08-0.el7_7.x86_64/jre"

#ADD USER HADOOPUSER
adduser hadoopuser
usermod -aG hadoopuser hadoopuser
chown hadoopuser:root -R /usr/local/hadoop/
chmod g+rwx -R /usr/local/hadoop/
id hadoopuser
uid=1001(hadoopuser) gid=1001(hadoopuser) groups=1001(hadoopuser)

#CHANGE HOSTNAME
hostnamectl 
hostnamectl set-hostname HADOOPMASTER1
hostnamectl --static 















