################################
# POSTGRES 13 HSTORE EXTENSION #
################################

#NOTE
This module implements the hstore data type for storing sets of key/value pairs within a single PostgreSQL value. 
This can be useful in various scenarios, such as rows with many attributes that are rarely examined, or semi-structured data. 
Keys and values are simply text strings.
The text representation of an hstore, used for input and output, includes zero or more key => value pairs separated by commas. Some examples:

"paperback" => "5",
"publisher" => "postgresqltutorial.com",
"language"  => "English",
"ISBN-13"   => "978-1449370001",
"weight" => "1 ounces"

The order of the pairs is not significant (and may not be reproduced on output). 
Whitespace between pairs or around the => sign is ignored. 
Double-quote keys and values that include whitespace, commas, =s or >s. 
To include a double quote or a backslash in a key or value, escape it with a backslash.
Each key in an hstore is unique. If you declare an hstore with duplicate keys, 
only one will be stored in the hstore and there is no guarantee as to which will be kept:

postgres=# SELECT 'a=>1,a=>2'::hstore;
  hstore
----------
 "a"=>"1"
(1 row)

A value (but not a key) can be an SQL NULL. For example:

key => NULL

The NULL keyword is case-insensitive. Double-quote the NULL to treat it as the ordinary string “NULL”.

#ACCESS DATABASE AND INSTALL EXTENSION

[postgres@localhost ~]$ /usr/local/pgsql-13.2/bin/psql -U postgres
psql (13.2)
Type "help" for help.

postgres=# create extension hstore;
CREATE EXTENSION
postgres=# \dx
                           List of installed extensions
  Name   | Version |   Schema   |                   Description
---------+---------+------------+--------------------------------------------------
 hstore  | 1.7     | public     | data type for storing sets of (key, value) pairs
 plpgsql | 1.0     | pg_catalog | PL/pgSQL procedural language
(2 rows)

#CREATE TABLE AND INSERT VALUES

postgres=# drop table books cascade;

postgres=# drop sequence serial_books;

postgres=# drop function fn_gen_md5();

postgres=# CREATE SEQUENCE serial_books INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE;

postgres=# CREATE TABLE books (serial numeric(100) NOT NULL DEFAULT nextval('serial_books'::regclass), title VARCHAR (255), attr hstore, hashmd5 CHARACTER VARYING(256) PRIMARY KEY);

postgres=# CREATE OR REPLACE FUNCTION fn_gen_md5()
RETURNS TRIGGER AS
$BODY$
	BEGIN
		IF (NEW.hashmd5 IS NOT NULL AND TG_OP='INSERT')
	    THEN
	      RAISE EXCEPTION 'cannot insert into the column "hashmd5". It''s a generated column';
	    ELSEIF (TG_OP='UPDATE' AND NEW.hashmd5 <> OLD.hashmd5)
	    THEN
		      RAISE EXCEPTION 'cannot update the column "hashmd5". It''s a generated column';
	    END IF;
		NEW.hashmd5=md5(NEW.title||NEW.attr);
		RETURN NEW;
	END;
$BODY$
LANGUAGE plpgsql;

postgres=# CREATE TRIGGER trg_gen_md5
	BEFORE INSERT OR UPDATE
	ON books
	FOR EACH ROW
	EXECUTE FUNCTION fn_gen_md5();

postgres=# \d+ books
                                                        Table "public.books"
 Column  |          Type          | Collation | Nullable |              Default              | Storage  | Stats target | Description
---------+------------------------+-----------+----------+-----------------------------------+----------+--------------+-------------
 serial  | numeric(100,0)         |           | not null | nextval('serial_books'::regclass) | main     |              |
 title   | character varying(255) |           |          |                                   | extended |              |
 attr    | hstore                 |           |          |                                   | extended |              |
 hashmd5 | character varying(256) |           | not null |                                   | extended |              |
Indexes:
    "books_pkey" PRIMARY KEY, btree (hashmd5)
Triggers:
    trg_gen_md5 BEFORE INSERT OR UPDATE ON books FOR EACH ROW EXECUTE FUNCTION fn_gen_md5()
Access method: heap

download file and run inserts https://github.com/danilo19ee/zdatabase/blob/master/POSTGRES/TRAINING/LOAD%20BOOK%20INSERTS

#NOTE
Querying data from an hstore column is similar to querying data from a column with native data type using the SELECT statement as follows:

postgres=# SELECT attr FROM books limit 10;
                                                                                                                                                   attr
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 "isbn"=>"1933988673", "status"=>"PUBLISH", "authors"=>"W. Frank Ableson,Charlie Collins,Robi Sen", "pageCount"=>"416", "categories"=>"Open Source,Mobile", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ableson.jpg", "publishedDate"=>"2009-04-01T00:00:00.000-0700"
 "isbn"=>"1935182722", "status"=>"PUBLISH", "authors"=>"W. Frank Ableson,Robi Sen", "pageCount"=>"592", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ableson2.jpg", "publishedDate"=>"2011-01-14T00:00:00.000-0800"
 "isbn"=>"1617290084", "status"=>"PUBLISH", "authors"=>"Gojko Adzic", "pageCount"=>"0", "categories"=>"Software Engineering", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/adzic.jpg", "publishedDate"=>"2011-06-03T00:00:00.000-0700"
 "isbn"=>"1933988746", "status"=>"PUBLISH", "authors"=>"Tariq Ahmed with Jon Hirschi,Faisal Abid", "pageCount"=>"576", "categories"=>"Internet", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ahmed.jpg", "publishedDate"=>"2009-02-02T00:00:00.000-0800"
 "isbn"=>"1935182420", "status"=>"PUBLISH", "authors"=>"Tariq Ahmed,Dan Orlando,John C. Bland II,Joel Hooks", "pageCount"=>"600", "categories"=>"Internet", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ahmed2.jpg", "publishedDate"=>"2010-11-15T00:00:00.000-0800"
 "isbn"=>"1933988312", "status"=>"PUBLISH", "authors"=>"Satnam Alag", "pageCount"=>"425", "categories"=>"Internet", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/alag.jpg", "publishedDate"=>"2008-10-01T00:00:00.000-0700"
 "isbn"=>"1933988320", "status"=>"PUBLISH", "authors"=>"Rob Allen,Nick Lo,Steven Brown", "pageCount"=>"432", "categories"=>"Web Development", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/allen.jpg", "publishedDate"=>"2008-12-01T00:00:00.000-0800"
 "isbn"=>"1933988797", "status"=>"PUBLISH", "authors"=>"Bernerd Allmon,Jeremy Anderson", "pageCount"=>"265", "categories"=>"Internet", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/allmon.jpg", "publishedDate"=>"2010-10-15T00:00:00.000-0700"
 "isbn"=>"1935182234", "status"=>"PUBLISH", "authors"=>"Andres Almiray,Danno Ferrin,James Shingler", "pageCount"=>"375", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/almiray.jpg", "publishedDate"=>"2012-06-04T00:00:00.000-0700"
 "isbn"=>"193518217X", "status"=>"PUBLISH", "authors"=>"Alexandre de Castro Alves", "pageCount"=>"325", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/alves.jpg", "publishedDate"=>"
2011-12-12T00:00:00.000-0800"
(10 rows)

Time: 1.643 ms

postgres=# EXPLAIN ANALYSE SELECT attr FROM books;
                                              QUERY PLAN
------------------------------------------------------------------------------------------------------
 Seq Scan on books  (cost=0.00..16.85 rows=285 width=274) (actual time=0.017..0.116 rows=285 loops=1)
 Planning Time: 0.221 ms
 Execution Time: 0.155 ms
(3 rows)

Time: 1.173 ms

#QUERY VALUE FOR A SPECIFIC KEY

#NOTE
Postgresql hstore provides the -> operator to query the value of a specific key from an hstore column. 

postgres=# SELECT attr -> 'isbn' AS isbn FROM books limit 10;
    isbn
------------
 1933988673
 1935182722
 1617290084
 1933988746
 1935182420
 1933988312
 1933988320
 1933988797
 1935182234
 193518217X
(10 rows)

Time: 1.088 ms

postgres=# explain analyse SELECT attr -> 'isbn' AS isbn FROM books;
                                             QUERY PLAN
-----------------------------------------------------------------------------------------------------
 Seq Scan on books  (cost=0.00..17.56 rows=285 width=32) (actual time=0.026..0.163 rows=285 loops=1)
 Planning Time: 0.061 ms
 Execution Time: 0.208 ms
(3 rows)

Time: 0.885 ms

#USE VALUE IN THE WHERE CLAUSE

#NOTE
You can use the -> operator in the WHERE clause to filter the rows whose values of the hstore column match the input value.

postgres=# SELECT title, attr -> 'authors' AS authors FROM books WHERE attr -> 'isbn' = '1933988797';
    title     |            authors
--------------+--------------------------------
 Flex on Java | Bernerd Allmon,Jeremy Anderson
(1 row)

Time: 1.089 ms

postgres=# explain analyse SELECT title, attr -> 'authors' AS authors FROM books WHERE attr -> 'isbn' = '1933988797';
                                           QUERY PLAN
-------------------------------------------------------------------------------------------------
 Seq Scan on books  (cost=0.00..18.28 rows=1 width=57) (actual time=0.034..0.164 rows=1 loops=1)
   Filter: ((attr -> 'isbn'::text) = '1933988797'::text)
   Rows Removed by Filter: 284
 Planning Time: 0.076 ms
 Execution Time: 0.190 ms
(5 rows)

Time: 1.693 ms

#ADD KEY-VALUE PAIRS TO EXISTING ROWS

#NOTE
With hstore column, you can easily add a new key-value pair to existing rows e.g., you can add free shipping key to the attr column of the books table as follows:

postgres=# UPDATE books SET attr = attr || '"freeshipping"=>"yes"' :: hstore;
UPDATE 285
Time: 14.734 ms

#NOTE
Now, you can check to see if the "freeshipping" => "yes" pair has been added successfully.

postgres=# SELECT title, attr -> 'freeshipping' AS freeshipping FROM books limit 10;
               title               | freeshipping
-----------------------------------+--------------
 Swing                             | yes
 Multimedia Computing              | yes
 Unlocking Android                 | yes
 Android in Action, Second Edition | yes
 Specification by Example          | yes
 Flex 3 in Action                  | yes
 Flex 4 in Action                  | yes
 Collective Intelligence in Action | yes
 Zend Framework in Action          | yes
 Flex on Java                      | yes
(10 rows)

Time: 1.395 ms

postgres=# explain analyse SELECT title, attr -> 'freeshipping' AS freeshipping FROM books;
                                             QUERY PLAN
-----------------------------------------------------------------------------------------------------
 Seq Scan on books  (cost=0.00..35.12 rows=570 width=57) (actual time=0.035..0.342 rows=285 loops=1)
 Planning Time: 0.061 ms
 Execution Time: 0.387 ms
(3 rows)

Time: 1.152 ms

#UPDATE EXISTING KEY-VALUE PAIR

#NOTE
You can update existing key-value pair using the UPDATE statement. The following statement updates the value of the "freeshipping" key to "no".

postgres=# UPDATE books SET attr = attr || '"freeshipping"=>"no"' :: hstore;
UPDATE 285
Time: 11.520 ms

#REMOVE EXISTING KEY-VALUE PAIR

#NOTE
PostgreSQL allows you to remove existing key-value pair from an hstore column. 
For example, the following statement removes the "freeshipping"=>"no" key-value pair in the attr column.

postgres=# UPDATE books SET attr = delete(attr, 'freeshipping');
UPDATE 285
Time: 12.740 ms

#CHECK FOR A SPECIFIC KEY IN HSTORE COLUMN

#NOTE
You can check for a specific key in an hstore column using the ? operator in the WHERE clause. 

postgres=# SELECT title, attr->'categories' as publisher, attr FROM books WHERE attr ? 'categories' limit 10;
               title               |      publisher       |                                                                                                                                                   attr

-----------------------------------+----------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Core OWL 5.0                      | Programming          | "isbn"=>"1884777503", "status"=>"PUBLISH", "authors"=>"Ted Neward", "pageCount"=>"500", "categories"=>"Programming", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/neward.jpg", "publishedDate"=>"1997-12-01T00:00:00.000-0800"
 Swing                             | Java                 | "isbn"=>"1884777848", "status"=>"PUBLISH", "authors"=>"Matthew Robinson,Pavel Vorobiev", "pageCount"=>"0", "categories"=>"Java", "publishedDate"=>"1999-12-01T00:00:00.000-0800" 
 Up to Speed with Swing            | 0                    | "isbn"=>"1884777643", "status"=>"PUBLISH", "authors"=>"Steven J. Gutz", "pageCount"=>"0", "categories"=>"0", "publishedDate"=>"1998-05-01T00:00:00.000-0700"
 Multimedia Computing              | 0                    | "isbn"=>"020152029X", "status"=>"PUBLISH", "authors"=>"Matthew E. Hodges", "pageCount"=>"0", "categories"=>"0", "publishedDate"=>"1993-09-01T00:00:00.000-0700" 
 Unlocking Android                 | Open Source,Mobile   | "isbn"=>"1933988673", "status"=>"PUBLISH", "authors"=>"W. Frank Ableson,Charlie Collins,Robi Sen", "pageCount"=>"416", "categories"=>"Open Source,Mobile", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ableson.jpg", "publishedDate"=>"2009-04-01T00:00:00.000-0700"
 Android in Action, Second Edition | Java                 | "isbn"=>"1935182722", "status"=>"PUBLISH", "authors"=>"W. Frank Ableson,Robi Sen", "pageCount"=>"592", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ableson2.jpg", "publishedDate"=>"2011-01-14T00:00:00.000-0800"
 Specification by Example          | Software Engineering | "isbn"=>"1617290084", "status"=>"PUBLISH", "authors"=>"Gojko Adzic", "pageCount"=>"0", "categories"=>"Software Engineering", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/adzic.jpg", "publishedDate"=>"2011-06-03T00:00:00.000-0700"
 Flex 3 in Action                  | Internet             | "isbn"=>"1933988746", "status"=>"PUBLISH", "authors"=>"Tariq Ahmed with Jon Hirschi,Faisal Abid", "pageCount"=>"576", "categories"=>"Internet", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ahmed.jpg", "publishedDate"=>"2009-02-02T00:00:00.000-0800"
 Flex 4 in Action                  | Internet             | "isbn"=>"1935182420", "status"=>"PUBLISH", "authors"=>"Tariq Ahmed,Dan Orlando,John C. Bland II,Joel Hooks", "pageCount"=>"600", "categories"=>"Internet", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ahmed2.jpg", "publishedDate"=>"2010-11-15T00:00:00.000-0800"
 Collective Intelligence in Action | Internet             | "isbn"=>"1933988312", "status"=>"PUBLISH", "authors"=>"Satnam Alag", "pageCount"=>"425", "categories"=>"Internet", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/alag.jpg", "publishedDate"=>"2008-10-01T00:00:00.000-0700"
(10 rows)

Time: 1.381 ms

postgres=# explain analyse SELECT title, attr->'categories' as publisher, attr FROM books WHERE attr ? 'categories';
                                              QUERY PLAN
------------------------------------------------------------------------------------------------------
 Seq Scan on books  (cost=0.00..45.27 rows=285 width=331) (actual time=0.034..0.214 rows=285 loops=1)
   Filter: (attr ? 'categories'::text)
 Planning Time: 0.285 ms
 Execution Time: 0.259 ms
(4 rows)

Time: 1.251 ms

#CHECK FOR A KEY-VALUE PAIR

#NOTE
You can query based on the hstore key-value pair using the @> operator. 

postgres=# SELECT title FROM books WHERE attr @> '"categories"=>"Java"' :: hstore limit 10;
                 title
---------------------------------------
 Swing
 Android in Action, Second Edition
 Griffon in Action
 OSGi in Depth
 Hibernate in Action
 Hibernate in Action (Chinese Edition)
 Java Persistence with Hibernate
 Hibernate Search in Action
 jQuery in Action, Second Edition
 Spring Dynamic Modules in Action
(10 rows)

Time: 1.084 ms

postgres=# explain analyse SELECT title FROM books WHERE attr @> '"categories"=>"Java"' :: hstore;
                                            QUERY PLAN
---------------------------------------------------------------------------------------------------
 Seq Scan on books  (cost=0.00..44.56 rows=52 width=25) (actual time=0.032..0.163 rows=67 loops=1)
   Filter: (attr @> '"categories"=>"Java"'::hstore)
   Rows Removed by Filter: 218
 Planning Time: 0.169 ms
 Execution Time: 0.189 ms
(5 rows)

Time: 0.945 ms

#QUERY ROWS THAT CONTAIN MULTIPLE SPECIFIED KEYS

#NOTE
You can query the rows whose hstore column contain multiple keys using ?& operator. 

postgres=# SELECT akeys (attr) FROM books limit 10;
                                 akeys
-----------------------------------------------------------------------
 {isbn,status,authors,pageCount,categories,thumbnailUrl,publishedDate}
 {isbn,status,authors,pageCount,categories,publishedDate}
 {isbn,status,authors,pageCount,categories,publishedDate}
 {isbn,status,authors,pageCount,categories,publishedDate}
 {isbn,status,authors,pageCount,categories,thumbnailUrl,publishedDate}
 {isbn,status,authors,pageCount,categories,thumbnailUrl,publishedDate}
 {isbn,status,authors,pageCount,categories,thumbnailUrl,publishedDate}
 {isbn,status,authors,pageCount,categories,thumbnailUrl,publishedDate}
 {isbn,status,authors,pageCount,categories,thumbnailUrl,publishedDate}
 {isbn,status,authors,pageCount,categories,thumbnailUrl,publishedDate}
(10 rows)

Time: 0.617 ms

postgres=# explain analyse SELECT akeys (attr) FROM books;
                                             QUERY PLAN
-----------------------------------------------------------------------------------------------------
 Seq Scan on books  (cost=0.00..44.56 rows=285 width=32) (actual time=0.036..0.473 rows=285 loops=1)
 Planning Time: 0.058 ms
 Execution Time: 0.524 ms
(3 rows)

Time: 1.067 ms

#GET ALL KEYS FROM AND HSTORE COLUMN

#NOTE
To get all keys from an hstore column, you use the akeys() function as follows:

postgres=# SELECT count(1) FROM books WHERE attr ?& ARRAY [ 'isbn', 'pageCount','publishedDate','thumbnailUrl','status','authors','categories'];
 count
-------
   273
(1 row)

Time: 2.714 ms

postgres=# explain analyse SELECT count(1) FROM books WHERE attr ?& ARRAY [ 'isbn', 'pageCount','publishedDate','thumbnailUrl','status','authors','categories'];
                                                QUERY PLAN
-----------------------------------------------------------------------------------------------------------
 Aggregate  (cost=45.23..45.24 rows=1 width=8) (actual time=0.522..0.523 rows=1 loops=1)
   ->  Seq Scan on books  (cost=0.00..44.56 rows=268 width=0) (actual time=0.034..0.486 rows=273 loops=1)
         Filter: (attr ?& '{isbn,pageCount,publishedDate,thumbnailUrl,status,authors,categories}'::text[])
         Rows Removed by Filter: 12
 Planning Time: 0.346 ms
 Execution Time: 0.562 ms
(6 rows)

Time: 1.716 ms

#NOTE
Or you can use the  skey() function if you want PostgreSQL to return the result as a set.

postgres=# SELECT skeys (attr) FROM books limit 10;
     skeys
---------------
 isbn
 status
 authors
 pageCount
 categories
 thumbnailUrl
 publishedDate
 isbn
 status
 authors
(10 rows)

Time: 1.354 ms

postgres=# explain analyse SELECT skeys (attr) FROM books;
                                                 QUERY PLAN
------------------------------------------------------------------------------------------------------------
 ProjectSet  (cost=0.00..1470.99 rows=285000 width=32) (actual time=0.047..0.776 rows=1983 loops=1)
   ->  Seq Scan on books  (cost=0.00..43.85 rows=285 width=274) (actual time=0.039..0.169 rows=285 loops=1)
 Planning Time: 0.858 ms
 Execution Time: 1.436 ms
(4 rows)

Time: 4.244 ms

#GET ALL VALUES FROM AN HSTORE COLUMN

#NOTE
Like keys, you can get all values from an hstore column using the  avals() function in the form of arrays.

postgres=# SELECT avals (attr) FROM books limit 10;
                                                                                               avals
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 {1884777503,PUBLISH,"Ted Neward",500,Programming,https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/neward.jpg,1997-12-01T00:00:00.000-0800}
 {1884777848,PUBLISH,"Matthew Robinson,Pavel Vorobiev",0,Java,1999-12-01T00:00:00.000-0800}
 {1884777643,PUBLISH,"Steven J. Gutz",0,0,1998-05-01T00:00:00.000-0700}
 {020152029X,PUBLISH,"Matthew E. Hodges",0,0,1993-09-01T00:00:00.000-0700}
 {1933988673,PUBLISH,"W. Frank Ableson,Charlie Collins,Robi Sen",416,"Open Source,Mobile",https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ableson.jpg,2009-04-01T00:00:00.000-0700}
 {1935182722,PUBLISH,"W. Frank Ableson,Robi Sen",592,Java,https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ableson2.jpg,2011-01-14T00:00:00.000-0800}
 {1617290084,PUBLISH,"Gojko Adzic",0,"Software Engineering",https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/adzic.jpg,2011-06-03T00:00:00.000-0700}
 {1933988746,PUBLISH,"Tariq Ahmed with Jon Hirschi,Faisal Abid",576,Internet,https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ahmed.jpg,2009-02-02T00:00:00.000-0800}
 {1935182420,PUBLISH,"Tariq Ahmed,Dan Orlando,John C. Bland II,Joel Hooks",600,Internet,https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ahmed2.jpg,2010-11-15T00:00:00.000-0800}
 {1933988312,PUBLISH,"Satnam Alag",425,Internet,https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/alag.jpg,2008-10-01T00:00:00.000-0700}
(10 rows)

Time: 1.149 ms

postgres=# explain analyse SELECT avals (attr) FROM books;
                                             QUERY PLAN
-----------------------------------------------------------------------------------------------------
 Seq Scan on books  (cost=0.00..44.56 rows=285 width=32) (actual time=0.036..0.525 rows=285 loops=1)
 Planning Time: 0.058 ms
 Execution Time: 0.575 ms
(3 rows)

Time: 1.125 ms

#NOTE
Or you can use the  svals() function if you want to get the result as a set.

postgres=# SELECT svals (attr) FROM books limit 10;
                                   svals
----------------------------------------------------------------------------
 1884777503
 PUBLISH
 Ted Neward
 500
 Programming
 https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/neward.jpg
 1997-12-01T00:00:00.000-0800
 1884777848
 PUBLISH
 Matthew Robinson,Pavel Vorobiev
(10 rows)

Time: 0.733 ms

postgres=# explain analyse SELECT svals (attr) FROM books;
                                                 QUERY PLAN
------------------------------------------------------------------------------------------------------------
 ProjectSet  (cost=0.00..1470.99 rows=285000 width=32) (actual time=0.034..0.672 rows=1983 loops=1)
   ->  Seq Scan on books  (cost=0.00..43.85 rows=285 width=274) (actual time=0.025..0.100 rows=285 loops=1)
 Planning Time: 0.066 ms
 Execution Time: 0.868 ms
(4 rows)

Time: 1.529 ms

#CONVERT HSTORE DATA TO JSON

#NOTE
PostgreSQL provides the hstore_to_json() function to convert hstore data to JSON. See the following statement:

postgres=# SELECT title, hstore_to_json (attr) json FROM books;
         title          |                                                                   json
------------------------+------------------------------------------------------------------------------------------------------------------------------------------
 PostgreSQL Tutorial    | {"weight": "11.2 ounces", "ISBN-13": "978-1449370000", "language": "English", "paperback": "243", "publisher": "postgresqltutorial.com"}
 PostgreSQL Cheat Sheet | {"weight": "1 ounces", "ISBN-13": "978-1449370001", "language": "English", "paperback": "5", "publisher": "postgresqltutorial.com"}
(2 rows)

postgres=# SELECT title, hstore_to_json (attr) json FROM books limit 10;
               title               |                                                                                                                                                    json
-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Core OWL 5.0                      | {"isbn": "1884777503", "status": "PUBLISH", "authors": "Ted Neward", "pageCount": "500", "categories": "Programming", "thumbnailUrl": "https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/neward.jpg", "publishedDate": "1997-12-01T00:00:00.000-0800"}
 Swing                             | {"isbn": "1884777848", "status": "PUBLISH", "authors": "Matthew Robinson,Pavel Vorobiev", "pageCount": "0", "categories": "Java", "publishedDate": "1999-12-01T00:00:00.000-0800"}
 Up to Speed with Swing            | {"isbn": "1884777643", "status": "PUBLISH", "authors": "Steven J. Gutz", "pageCount": "0", "categories": "0", "publishedDate": "1998-05-01T00:00:00.000-0700"}
 Multimedia Computing              | {"isbn": "020152029X", "status": "PUBLISH", "authors": "Matthew E. Hodges", "pageCount": "0", "categories": "0", "publishedDate": "1993-09-01T00:00:00.000-0700"}
 Unlocking Android                 | {"isbn": "1933988673", "status": "PUBLISH", "authors": "W. Frank Ableson,Charlie Collins,Robi Sen", "pageCount": "416", "categories": "Open Source,Mobile", "thumbnailUrl": "https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ableson.jpg", "publishedDate": "2009-04-01T00:00:00.000-0700"}
 Android in Action, Second Edition | {"isbn": "1935182722", "status": "PUBLISH", "authors": "W. Frank Ableson,Robi Sen", "pageCount": "592", "categories": "Java", "thumbnailUrl": "https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ableson2.jpg", "publishedDate": "2011-01-14T00:00:00.000-0800"}
 Specification by Example          | {"isbn": "1617290084", "status": "PUBLISH", "authors": "Gojko Adzic", "pageCount": "0", "categories": "Software Engineering", "thumbnailUrl": "https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/adzic.jpg", "publishedDate": "2011-06-03T00:00:00.000-0700"}
 Flex 3 in Action                  | {"isbn": "1933988746", "status": "PUBLISH", "authors": "Tariq Ahmed with Jon Hirschi,Faisal Abid", "pageCount": "576", "categories": "Internet", "thumbnailUrl": "https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ahmed.jpg", "publishedDate": "2009-02-02T00:00:00.000-0800"}
 Flex 4 in Action                  | {"isbn": "1935182420", "status": "PUBLISH", "authors": "Tariq Ahmed,Dan Orlando,John C. Bland II,Joel Hooks", "pageCount": "600", "categories": "Internet", "thumbnailUrl": "https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ahmed2.jpg", "publishedDate": "2010-11-15T00:00:00.000-0800"}
 Collective Intelligence in Action | {"isbn": "1933988312", "status": "PUBLISH", "authors": "Satnam Alag", "pageCount": "425", "categories": "Internet", "thumbnailUrl": "https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/alag.jpg", "publishedDate": "2008-10-01T00:00:00.000-0700"}
(10 rows)

Time: 1.080 ms

postgres=# explain analyse SELECT title, hstore_to_json (attr) json FROM books;
                                             QUERY PLAN
-----------------------------------------------------------------------------------------------------
 Seq Scan on books  (cost=0.00..44.56 rows=285 width=57) (actual time=0.039..1.294 rows=285 loops=1)
 Planning Time: 0.086 ms
 Execution Time: 1.339 ms
(3 rows)

Time: 2.002 ms

#CONVERT HSTORE DATA TO SETS

#NOTE
To convert hstore data to sets, you use the  each() function as follows:

postgres=# select title, (EACH(attr) ).* from books limit 10;
               title               |      key      |                                    value
-----------------------------------+---------------+-----------------------------------------------------------------------------
 Unlocking Android                 | isbn          | 1933988673
 Unlocking Android                 | status        | PUBLISH
 Unlocking Android                 | authors       | W. Frank Ableson,Charlie Collins,Robi Sen
 Unlocking Android                 | pageCount     | 416
 Unlocking Android                 | categories    | Open Source,Mobile
 Unlocking Android                 | thumbnailUrl  | https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ableson.jpg
 Unlocking Android                 | publishedDate | 2009-04-01T00:00:00.000-0700
 Android in Action, Second Edition | isbn          | 1935182722
 Android in Action, Second Edition | status        | PUBLISH
 Android in Action, Second Edition | authors       | W. Frank Ableson,Robi Sen
(10 rows)

Time: 1.109 ms

postgres=# explain analyse select title, (EACH(attr) ).* from books;
                                                    QUERY PLAN
------------------------------------------------------------------------------------------------------------------
 Result  (cost=0.00..5718.99 rows=285000 width=89) (actual time=0.039..3.120 rows=1983 loops=1)
   ->  ProjectSet  (cost=0.00..1443.99 rows=285000 width=57) (actual time=0.033..2.388 rows=1983 loops=1)
         ->  Seq Scan on books  (cost=0.00..16.85 rows=285 width=299) (actual time=0.018..0.151 rows=285 loops=1)
 Planning Time: 0.124 ms
 Execution Time: 3.332 ms
(5 rows)

Time: 4.063 ms

#EXAMPLE INDEXING WITH HSTORE DATA

==================================================================================================================================

$$$ HIGHER COST WITH LESS TIME $$$

postgres=# SELECT title, attr -> 'authors' AS authors FROM books WHERE attr -> 'isbn' = '1933988797';
    title     |            authors
--------------+--------------------------------
 Flex on Java | Bernerd Allmon,Jeremy Anderson
(1 row)

Time: 1.089 ms

postgres=# explain analyse SELECT title, attr -> 'authors' AS authors FROM books WHERE attr -> 'isbn' = '1933988797';
                                           QUERY PLAN
-------------------------------------------------------------------------------------------------
 Seq Scan on books  (cost=0.00..18.28 rows=1 width=57) (actual time=0.034..0.164 rows=1 loops=1)
   Filter: ((attr -> 'isbn'::text) = '1933988797'::text)
   Rows Removed by Filter: 284
 Planning Time: 0.076 ms
 Execution Time: 0.190 ms
(5 rows)

postgres=# CREATE INDEX hidx_books_attr_isbn ON books ((attr -> 'isbn'));
CREATE INDEX

postgres=# SELECT title, attr -> 'authors' AS authors FROM books WHERE attr -> 'isbn' = '1933988797';
    title     |            authors
--------------+--------------------------------
 Flex on Java | Bernerd Allmon,Jeremy Anderson
(1 row)

Time: 0.767 ms

postgres=# explain analyse SELECT title, attr -> 'authors' AS authors FROM books WHERE attr -> 'isbn' = '1933988797';
                                                         QUERY PLAN
-----------------------------------------------------------------------------------------------------------------------------
 Index Scan using hidx_books_attr_isbn on books  (cost=0.27..8.29 rows=1 width=57) (actual time=0.036..0.038 rows=1 loops=1)
   Index Cond: ((attr -> 'isbn'::text) = '1933988797'::text)
 Planning Time: 0.607 ms
 Execution Time: 0.479 ms
(4 rows)

==================================================================================================================================

$$$ LESS COST WITH LESS TIME $$$

postgres=# SELECT count(*) FROM books WHERE attr -> 'categories' = '0';
 count
-------
    50
(1 row)

Time: 1.963 ms

postgres=# EXPLAIN ANALYZE SELECT count(*) FROM books WHERE attr -> 'categories' = '0';
                                              QUERY PLAN
-------------------------------------------------------------------------------------------------------
 Aggregate  (cost=18.28..18.29 rows=1 width=8) (actual time=0.172..0.173 rows=1 loops=1)
   ->  Seq Scan on books  (cost=0.00..18.27 rows=1 width=0) (actual time=0.134..0.159 rows=50 loops=1)
         Filter: ((attr -> 'categories'::text) = '0'::text)
         Rows Removed by Filter: 235
 Planning Time: 0.131 ms
 Execution Time: 0.214 ms
(6 rows)

Time: 1.134 ms

postgres=# CREATE INDEX hidx_books_attr_categories ON books ((attr -> 'categories')) WHERE ((attr -> 'categories'::text) = '0'::text);
CREATE INDEX

postgres=# SELECT count(*) FROM books WHERE attr -> 'categories' = '0';
 count
-------
    50
(1 row)

Time: 1.248 ms

postgres=# EXPLAIN ANALYZE SELECT count(*) FROM books WHERE attr -> 'categories' = '0';
                                                                  QUERY PLAN
----------------------------------------------------------------------------------------------------------------------------------------------
 Aggregate  (cost=8.16..8.17 rows=1 width=8) (actual time=0.064..0.065 rows=1 loops=1)
   ->  Index Only Scan using hidx_books_attr_categories on books  (cost=0.14..8.15 rows=1 width=0) (actual time=0.020..0.049 rows=50 loops=1)
         Heap Fetches: 50
 Planning Time: 0.164 ms
 Execution Time: 0.104 ms
(5 rows)

Time: 1.097 ms

==================================================================================================================================

$$$ HIGHER COST WITH HIGHER TIME WITH GIN INDEX $$$

postgres=# SELECT B.* FROM books as B where B.attr @> hstore('categories','Java') limit 10;
 serial |                 title                 |                                                                                                                                                 attr																																					|             hashmd5
--------+---------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------
      2 | Android in Action, Second Edition     | "isbn"=>"1935182722", "status"=>"PUBLISH", "authors"=>"W. Frank Ableson,Robi Sen", "pageCount"=>"592", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ableson2.jpg", "publishedDate"=>"2011-01-14T00:00:00.000-0800"                         	| 22900b975aefea5393efebeb3803cbfd
      9 | Griffon in Action                     | "isbn"=>"1935182234", "status"=>"PUBLISH", "authors"=>"Andres Almiray,Danno Ferrin,James Shingler", "pageCount"=>"375", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/almiray.jpg", "publishedDate"=>"2012-06-04T00:00:00.000-0700"         	| 46063909731aa296cf49521da6c4f2e7
     10 | OSGi in Depth                         | "isbn"=>"193518217X", "status"=>"PUBLISH", "authors"=>"Alexandre de Castro Alves", "pageCount"=>"325", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/alves.jpg", "publishedDate"=>"2011-12-12T00:00:00.000-0800"                            	| de5fa45d2be258150fdcd926374f52da
     21 | Hibernate in Action                   | "isbn"=>"193239415X", "status"=>"PUBLISH", "authors"=>"Christian Bauer,Gavin King", "pageCount"=>"400", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bauer.jpg", "publishedDate"=>"2004-08-01T00:00:00.000-0700"                           	| d1cddc48dc2965d9972b926bb13e4bc1
     22 | Hibernate in Action (Chinese Edition) | "isbn"=>"193239416X", "status"=>"PUBLISH", "authors"=>"Christian Bauer,Gavin King", "pageCount"=>"400", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bauer-cn.jpg", "publishedDate"=>"1999-06-01T00:00:00.000-0700"                        	| 93bb2f00bb204a8863b59edcd7b4f153
     23 | Java Persistence with Hibernate       | "isbn"=>"1932394885", "status"=>"PUBLISH", "authors"=>"Christian Bauer,Gavin King", "pageCount"=>"880", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bauer2.jpg", "publishedDate"=>"2006-11-01T00:00:00.000-0800"                          	| a23c29d56b4fe8d3ef59dbaf055cca92
     27 | Hibernate Search in Action            | "isbn"=>"1933988649", "status"=>"PUBLISH", "authors"=>"Emmanuel Bernard,John Griffin", "pageCount"=>"488", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bernard.jpg", "publishedDate"=>"2008-12-21T00:00:00.000-0800"                      	| c52de590ace42a8bb29e018908e0998a
     29 | jQuery in Action, Second Edition      | "isbn"=>"1935182323", "status"=>"PUBLISH", "authors"=>"Bear Bibeault,Yehuda Katz", "pageCount"=>"488", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bibeault2.jpg", "publishedDate"=>"2010-06-01T00:00:00.000-0700"                        	| 6c8ca850a234347720f21fb25794bc9a
     45 | Spring Dynamic Modules in Action      | "isbn"=>"1935182307", "status"=>"PUBLISH", "authors"=>"Arnaud Cogoluegnes,Thierry Templier,Andy Piper", "pageCount"=>"450", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/cogoluegnes.jpg", "publishedDate"=>"2010-09-04T00:00:00.000-0700" 	| fff6b4aa73be4b3ac4d3405379c7dc6a
     51 | POJOs in Action                       | "isbn"=>"1932394583", "status"=>"PUBLISH", "authors"=>"Chris Richardson", "pageCount"=>"592", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/crichardson.jpg", "publishedDate"=>"2006-01-01T00:00:00.000-0800"                               	| fb49acf85c1c4b04f3dfe0d1882f062a
(10 rows)

Time: 0.981 ms

postgres=# EXPLAIN SELECT B.* FROM books as B where B.attr @> hstore('categories','Java');
                        QUERY PLAN
-----------------------------------------------------------
 Seq Scan on books b  (cost=0.00..17.56 rows=52 width=337)
   Filter: (attr @> '"categories"=>"Java"'::hstore)
(2 rows)

Time: 1.392 ms

postgres=# CREATE INDEX ginidx_books_attr ON books USING GIN (attr);
CREATE INDEX

#NOTE 
As the table is small, it is necessary to disable sequential reading for the use of the index

postgres=# set enable_seqscan=false;
SET

postgres=# SELECT B.* FROM books as B where B.attr @> hstore('categories','Java') limit 10;
 serial |                 title                 |                                                                                                                                                 attr																																					|             hashmd5
--------+---------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------
      2 | Android in Action, Second Edition     | "isbn"=>"1935182722", "status"=>"PUBLISH", "authors"=>"W. Frank Ableson,Robi Sen", "pageCount"=>"592", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ableson2.jpg", "publishedDate"=>"2011-01-14T00:00:00.000-0800"                         	| 22900b975aefea5393efebeb3803cbfd
      9 | Griffon in Action                     | "isbn"=>"1935182234", "status"=>"PUBLISH", "authors"=>"Andres Almiray,Danno Ferrin,James Shingler", "pageCount"=>"375", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/almiray.jpg", "publishedDate"=>"2012-06-04T00:00:00.000-0700"         	| 46063909731aa296cf49521da6c4f2e7
     10 | OSGi in Depth                         | "isbn"=>"193518217X", "status"=>"PUBLISH", "authors"=>"Alexandre de Castro Alves", "pageCount"=>"325", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/alves.jpg", "publishedDate"=>"2011-12-12T00:00:00.000-0800"                            	| de5fa45d2be258150fdcd926374f52da
     21 | Hibernate in Action                   | "isbn"=>"193239415X", "status"=>"PUBLISH", "authors"=>"Christian Bauer,Gavin King", "pageCount"=>"400", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bauer.jpg", "publishedDate"=>"2004-08-01T00:00:00.000-0700"                           	| d1cddc48dc2965d9972b926bb13e4bc1
     22 | Hibernate in Action (Chinese Edition) | "isbn"=>"193239416X", "status"=>"PUBLISH", "authors"=>"Christian Bauer,Gavin King", "pageCount"=>"400", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bauer-cn.jpg", "publishedDate"=>"1999-06-01T00:00:00.000-0700"                        	| 93bb2f00bb204a8863b59edcd7b4f153
     23 | Java Persistence with Hibernate       | "isbn"=>"1932394885", "status"=>"PUBLISH", "authors"=>"Christian Bauer,Gavin King", "pageCount"=>"880", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bauer2.jpg", "publishedDate"=>"2006-11-01T00:00:00.000-0800"                          	| a23c29d56b4fe8d3ef59dbaf055cca92
     27 | Hibernate Search in Action            | "isbn"=>"1933988649", "status"=>"PUBLISH", "authors"=>"Emmanuel Bernard,John Griffin", "pageCount"=>"488", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bernard.jpg", "publishedDate"=>"2008-12-21T00:00:00.000-0800"                      	| c52de590ace42a8bb29e018908e0998a
     29 | jQuery in Action, Second Edition      | "isbn"=>"1935182323", "status"=>"PUBLISH", "authors"=>"Bear Bibeault,Yehuda Katz", "pageCount"=>"488", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bibeault2.jpg", "publishedDate"=>"2010-06-01T00:00:00.000-0700"                        	| 6c8ca850a234347720f21fb25794bc9a
     45 | Spring Dynamic Modules in Action      | "isbn"=>"1935182307", "status"=>"PUBLISH", "authors"=>"Arnaud Cogoluegnes,Thierry Templier,Andy Piper", "pageCount"=>"450", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/cogoluegnes.jpg", "publishedDate"=>"2010-09-04T00:00:00.000-0700" 	| fff6b4aa73be4b3ac4d3405379c7dc6a
     51 | POJOs in Action                       | "isbn"=>"1932394583", "status"=>"PUBLISH", "authors"=>"Chris Richardson", "pageCount"=>"592", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/crichardson.jpg", "publishedDate"=>"2006-01-01T00:00:00.000-0800"                               	| fb49acf85c1c4b04f3dfe0d1882f062a
(10 rows)
Time: 1.119 ms

postgres=# EXPLAIN SELECT B.* FROM books as B where B.attr @> hstore('categories','Java');
                                    QUERY PLAN
----------------------------------------------------------------------------------
 Bitmap Heap Scan on books b  (cost=20.40..35.05 rows=52 width=337)
   Recheck Cond: (attr @> '"categories"=>"Java"'::hstore)
   ->  Bitmap Index Scan on ginidx_books_attr  (cost=0.00..20.39 rows=52 width=0)
         Index Cond: (attr @> '"categories"=>"Java"'::hstore)
(4 rows)

Time: 1.335 ms

==================================================================================================================================

$$$ HIGHER COST WITH HIGHER TIME WITH GIN INDEX $$$

postgres=# SELECT B.* FROM books as B where B.attr @> hstore('categories','Java') limit 10;
 serial |                 title                 |                                                                                                                                                 attr																																					|             hashmd5
--------+---------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------
      2 | Android in Action, Second Edition     | "isbn"=>"1935182722", "status"=>"PUBLISH", "authors"=>"W. Frank Ableson,Robi Sen", "pageCount"=>"592", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ableson2.jpg", "publishedDate"=>"2011-01-14T00:00:00.000-0800"                         	| 22900b975aefea5393efebeb3803cbfd
      9 | Griffon in Action                     | "isbn"=>"1935182234", "status"=>"PUBLISH", "authors"=>"Andres Almiray,Danno Ferrin,James Shingler", "pageCount"=>"375", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/almiray.jpg", "publishedDate"=>"2012-06-04T00:00:00.000-0700"         	| 46063909731aa296cf49521da6c4f2e7
     10 | OSGi in Depth                         | "isbn"=>"193518217X", "status"=>"PUBLISH", "authors"=>"Alexandre de Castro Alves", "pageCount"=>"325", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/alves.jpg", "publishedDate"=>"2011-12-12T00:00:00.000-0800"                            	| de5fa45d2be258150fdcd926374f52da
     21 | Hibernate in Action                   | "isbn"=>"193239415X", "status"=>"PUBLISH", "authors"=>"Christian Bauer,Gavin King", "pageCount"=>"400", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bauer.jpg", "publishedDate"=>"2004-08-01T00:00:00.000-0700"                           	| d1cddc48dc2965d9972b926bb13e4bc1
     22 | Hibernate in Action (Chinese Edition) | "isbn"=>"193239416X", "status"=>"PUBLISH", "authors"=>"Christian Bauer,Gavin King", "pageCount"=>"400", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bauer-cn.jpg", "publishedDate"=>"1999-06-01T00:00:00.000-0700"                        	| 93bb2f00bb204a8863b59edcd7b4f153
     23 | Java Persistence with Hibernate       | "isbn"=>"1932394885", "status"=>"PUBLISH", "authors"=>"Christian Bauer,Gavin King", "pageCount"=>"880", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bauer2.jpg", "publishedDate"=>"2006-11-01T00:00:00.000-0800"                          	| a23c29d56b4fe8d3ef59dbaf055cca92
     27 | Hibernate Search in Action            | "isbn"=>"1933988649", "status"=>"PUBLISH", "authors"=>"Emmanuel Bernard,John Griffin", "pageCount"=>"488", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bernard.jpg", "publishedDate"=>"2008-12-21T00:00:00.000-0800"                      	| c52de590ace42a8bb29e018908e0998a
     29 | jQuery in Action, Second Edition      | "isbn"=>"1935182323", "status"=>"PUBLISH", "authors"=>"Bear Bibeault,Yehuda Katz", "pageCount"=>"488", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bibeault2.jpg", "publishedDate"=>"2010-06-01T00:00:00.000-0700"                        	| 6c8ca850a234347720f21fb25794bc9a
     45 | Spring Dynamic Modules in Action      | "isbn"=>"1935182307", "status"=>"PUBLISH", "authors"=>"Arnaud Cogoluegnes,Thierry Templier,Andy Piper", "pageCount"=>"450", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/cogoluegnes.jpg", "publishedDate"=>"2010-09-04T00:00:00.000-0700" 	| fff6b4aa73be4b3ac4d3405379c7dc6a
     51 | POJOs in Action                       | "isbn"=>"1932394583", "status"=>"PUBLISH", "authors"=>"Chris Richardson", "pageCount"=>"592", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/crichardson.jpg", "publishedDate"=>"2006-01-01T00:00:00.000-0800"                               	| fb49acf85c1c4b04f3dfe0d1882f062a
(10 rows)

Time: 1.050 ms

postgres=# EXPLAIN SELECT B.* FROM books as B where B.attr @> hstore('categories','Java');
                        QUERY PLAN
-----------------------------------------------------------
 Seq Scan on books b  (cost=0.00..17.56 rows=52 width=337)
   Filter: (attr @> '"categories"=>"Java"'::hstore)
(2 rows)

Time: 1.055 ms

postgres=# CREATE INDEX gistidx_books_attr ON books USING GIST (attr);
CREATE INDEX
Time: 17.335 ms

postgres=# set enable_seqscan=false;
SET

postgres=# SELECT B.* FROM books as B where B.attr @> hstore('categories','Java') limit 10;
 serial |                 title                 |                                                                                                                                                 attr																																					|             hashmd5
--------+---------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------
      2 | Android in Action, Second Edition     | "isbn"=>"1935182722", "status"=>"PUBLISH", "authors"=>"W. Frank Ableson,Robi Sen", "pageCount"=>"592", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/ableson2.jpg", "publishedDate"=>"2011-01-14T00:00:00.000-0800"                         	| 22900b975aefea5393efebeb3803cbfd
      9 | Griffon in Action                     | "isbn"=>"1935182234", "status"=>"PUBLISH", "authors"=>"Andres Almiray,Danno Ferrin,James Shingler", "pageCount"=>"375", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/almiray.jpg", "publishedDate"=>"2012-06-04T00:00:00.000-0700"         	| 46063909731aa296cf49521da6c4f2e7
     10 | OSGi in Depth                         | "isbn"=>"193518217X", "status"=>"PUBLISH", "authors"=>"Alexandre de Castro Alves", "pageCount"=>"325", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/alves.jpg", "publishedDate"=>"2011-12-12T00:00:00.000-0800"                            	| de5fa45d2be258150fdcd926374f52da
     21 | Hibernate in Action                   | "isbn"=>"193239415X", "status"=>"PUBLISH", "authors"=>"Christian Bauer,Gavin King", "pageCount"=>"400", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bauer.jpg", "publishedDate"=>"2004-08-01T00:00:00.000-0700"                           	| d1cddc48dc2965d9972b926bb13e4bc1
     22 | Hibernate in Action (Chinese Edition) | "isbn"=>"193239416X", "status"=>"PUBLISH", "authors"=>"Christian Bauer,Gavin King", "pageCount"=>"400", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bauer-cn.jpg", "publishedDate"=>"1999-06-01T00:00:00.000-0700"                        	| 93bb2f00bb204a8863b59edcd7b4f153
     23 | Java Persistence with Hibernate       | "isbn"=>"1932394885", "status"=>"PUBLISH", "authors"=>"Christian Bauer,Gavin King", "pageCount"=>"880", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bauer2.jpg", "publishedDate"=>"2006-11-01T00:00:00.000-0800"                          	| a23c29d56b4fe8d3ef59dbaf055cca92
     27 | Hibernate Search in Action            | "isbn"=>"1933988649", "status"=>"PUBLISH", "authors"=>"Emmanuel Bernard,John Griffin", "pageCount"=>"488", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bernard.jpg", "publishedDate"=>"2008-12-21T00:00:00.000-0800"                      	| c52de590ace42a8bb29e018908e0998a
     29 | jQuery in Action, Second Edition      | "isbn"=>"1935182323", "status"=>"PUBLISH", "authors"=>"Bear Bibeault,Yehuda Katz", "pageCount"=>"488", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/bibeault2.jpg", "publishedDate"=>"2010-06-01T00:00:00.000-0700"                        	| 6c8ca850a234347720f21fb25794bc9a
     45 | Spring Dynamic Modules in Action      | "isbn"=>"1935182307", "status"=>"PUBLISH", "authors"=>"Arnaud Cogoluegnes,Thierry Templier,Andy Piper", "pageCount"=>"450", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/cogoluegnes.jpg", "publishedDate"=>"2010-09-04T00:00:00.000-0700" 	| fff6b4aa73be4b3ac4d3405379c7dc6a
     51 | POJOs in Action                       | "isbn"=>"1932394583", "status"=>"PUBLISH", "authors"=>"Chris Richardson", "pageCount"=>"592", "categories"=>"Java", "thumbnailUrl"=>"https://s3.amazonaws.com/AKIAJC5RLADLUMVRPFDQ.book-thumb-images/crichardson.jpg", "publishedDate"=>"2006-01-01T00:00:00.000-0800"                               	| fb49acf85c1c4b04f3dfe0d1882f062a
(10 rows)

Time: 1.230 ms

postgres=# EXPLAIN SELECT B.* FROM books as B where B.attr @> hstore('categories','Java');
                                    QUERY PLAN
----------------------------------------------------------------------------------
 Bitmap Heap Scan on books b  (cost=4.54..19.19 rows=52 width=337)
   Recheck Cond: (attr @> '"categories"=>"Java"'::hstore)
   ->  Bitmap Index Scan on gistidx_books_attr  (cost=0.00..4.53 rows=52 width=0)
         Index Cond: (attr @> '"categories"=>"Java"'::hstore)
(4 rows)

Time: 1.364 ms

==================================================================================================================================





