+++++++++++++++++++++++++++++++++++++
+   ORACLE 19C SI ONE CDB EBS       +
+++++++++++++++++++++++++++++++++++++

#ORACLE DATABASE MACHINE
IP 192.168.1.130
Disk /dev/sda: 37.6 GB
/dev/sda1 /boot 350 MB
/dev/sda2 /		31  GB
/dev/sda3 swap	4	GB	
	
Disk /dev/sdb: 107.4 GB
Disk /dev/sdc: 107.4 GB
Disk /dev/sdd: 107.4 GB
LVM  /u01 		 300 GB		


INSTALL PRE-INSTALL PACKAGES
yum install http://yum.oracle.com/repo/OracleLinux/OL7/latest/x86_64/getPackage/oracle-database-preinstall-19c-1.0-1.el7.x86_64.rpm

#DISABLE SELINUX AND FIREWALLD
sed -i 's/SELINUX=.*/SELINUX=disabled/' /etc/sysconfig/selinux && setenforce 0
systemctl stop firewalld && systemctl disable firewalld

#CONFIGURE STATIC NETWORK
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=none
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=no
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=enp0s3
UUID=49c279da-7065-40f5-b914-176973db2a0a
DEVICE=enp0s3
ONBOOT=yes
IPADDR=192.168.1.130
PREFIX=24
GATEWAY=192.168.1.1
DNS1=8.8.8.8

#CONFIGURE HOSTNAME
hostnamectl 
hostnamectl set-hostname ol7db1
hostnamectl --static 

#CONFIGURE /ETC/HOSTS
192.168.1.131   ol7apps1
192.168.1.130   ol7db1

#CREATE LVM
fdisk /dev/sdb
fdisk /dev/sdc
fdisk /dev/sdd

Command (m for help): n
Partition type:
   p   primary (0 primary, 0 extended, 4 free)
   e   extended
Select (default p): p
Partition number (1-4, default 1): 1
First sector (2048-209715199, default 2048):
Using default value 2048
Last sector, +sectors or +size{K,M,G} (2048-209715199, default 209715199):
Using default value 209715199
Partition 1 of type Linux and of size 100 GiB is set
Command (m for help): w
The partition table has been altered!
Calling ioctl() to re-read partition table.
Syncing disks.

pvcreate /dev/sdb1 /dev/sdc1 /dev/sdd1 
  Physical volume "/dev/sdb1" successfully created.
  Physical volume "/dev/sdc1" successfully created.
  Physical volume "/dev/sdd1" successfully created.
  
vgcreate vg_database /dev/sdb1 /dev/sdc1 /dev/sdd1
  Volume group "vg_database" successfully created
  
vgs
  VG          #PV #LV #SN Attr   VSize    VFree
  vg_database   3   0   0 wz--n- <299.99g <299.99g
  
lvcreate --name lv_database -l 100%FREE vg_database
  Logical volume "lv_database" created.
  
lvs
  LV          VG          Attr       LSize    Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  lv_database vg_database -wi-a----- <299.99g
  
lvdisplay
  --- Logical volume ---
  LV Path                /dev/vg_database/lv_database
  LV Name                lv_database
  VG Name                vg_database
  LV UUID                SR7sv5-jUVO-Xbl8-kqvL-P2xf-Lvr7-z34xur
  LV Write Access        read/write
  LV Creation host, time ol7db1, 2019-12-28 18:15:15 -0300
  LV Status              available
  # open                 0
  LV Size                <299.99 GiB
  Current LE             76797
  Segments               3
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           252:0

vi /etc/fstab
/dev/vg_database/lv_database              /u01                    ext4    defaults        1 1

mkfs.ext4 /dev/vg_database/lv_database
mkdir -p /u01
mount /u01
chown oracle:oinstall -R /u01

df -h 
/dev/mapper/vg_database-lv_database  296G   65M  281G   1% /u01

tune2fs -m 0 /dev/mapper/vg_database-lv_database

df -h
/dev/mapper/vg_database-lv_database  296G   65M  296G   1% /u01

#INSTALL ORACLE DATABASE 19C
#THERE IS A DOCUMENT WITH ORACLE DATABASE 19C INSTALATION STEPS (ORACLE DATABASE 19C SI FS REDHATEL8)

#CREATE ORACLE_BASE AND ORACLE_HOME DIRECTORIES
mkdir -p /u01/app/oracle/product/19.3.0/dbhome_1
mkdir -p /u01/oradata
chown -R oracle:oinstall /u01
chmod -R 775 /u01

#CONFIGURE VARIABLES
su - oracle
mkdir /home/oracle/scripts

cat > /home/oracle/scripts/setEnv.sh <<EOF
# Oracle Settings
export TMP=/tmp
export TMPDIR=\$TMP

export ORACLE_HOSTNAME=ol7db1
export ORACLE_UNQNAME=appscdb1
export ORACLE_BASE=/u01/app/oracle
export ORACLE_HOME=\$ORACLE_BASE/product/19.3.0/dbhome_1
export ORA_INVENTORY=/u01/app/oraInventory
export ORACLE_SID=appscdb1

export PATH=/usr/sbin:/usr/local/bin:\$PATH
export PATH=\$ORACLE_HOME/bin:\$PATH

export LD_LIBRARY_PATH=\$ORACLE_HOME/lib:/lib:/usr/lib
export CLASSPATH=\$ORACLE_HOME/jlib:\$ORACLE_HOME/rdbms/jlib
EOF

echo ". /home/oracle/scripts/setEnv.sh" >> /home/oracle/.bash_profile

cat > /home/oracle/scripts/start_all.sh <<EOF
#!/bin/bash
. /home/oracle/scripts/setEnv.sh

export ORAENV_ASK=NO
. oraenv
export ORAENV_ASK=YES

dbstart \$ORACLE_HOME
EOF

cat > /home/oracle/scripts/stop_all.sh <<EOF
#!/bin/bash
. /home/oracle/scripts/setEnv.sh

export ORAENV_ASK=NO
. oraenv
export ORAENV_ASK=YES

dbshut \$ORACLE_HOME
EOF

chown -R oracle:oinstall /home/oracle/scripts
chmod u+x /home/oracle/scripts/*.sh

#DOWNLOAD AND INSTALL ORACLE DATABASE 19.3C
wget https://download.oracle.com/otn/linux/oracle19c/190000/LINUX.X64_193000_db_home.zip?AuthParam=1577574051_dcd3a71670cb8ddcb11b27e39a41738e

