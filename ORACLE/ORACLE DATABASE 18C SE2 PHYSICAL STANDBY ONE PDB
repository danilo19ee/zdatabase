+++++++++++++++++++++++++++++++++++++++++++++++++++++++
+   	ORACLE DATABASE 18C PHYSICAL STANDBY ONE PDB    +
+++++++++++++++++++++++++++++++++++++++++++++++++++++++

#NEED TWO MACHINES OL7 
+-------------------+------------+
|192.168.1.130 PROD | ORACLE SE2 |
|192.168.1.131 STDB | ORACLE SE2 |
+-------------------+------------+

$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

#PREPARING MACHINES TO EXECUTE THE PRODUCTION AND STANDBY DATABASES

#INSTALL PRE-INSTALL PACKAGES BOTH MACHINES
yum install http://yum.oracle.com/repo/OracleLinux/OL7/latest/x86_64/getPackage/oracle-database-preinstall-18c-1.0-1.el7.x86_64.rpm

#DISABLE SELINUX AND FIREWALLD BOTH MACHINES
sed -i 's/SELINUX=.*/SELINUX=disabled/' /etc/selinux/config && setenforce 0
systemctl stop firewalld && systemctl disable firewalld

#CONFIGURE STATIC NETWORK MACHINE PROD
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=none
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=no
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=enp0s3
UUID=49c279da-7065-40f5-b914-176973db2a0a
DEVICE=enp0s3
ONBOOT=yes
IPADDR=192.168.1.130
PREFIX=24
GATEWAY=192.168.1.1
DNS1=8.8.8.8

#CONFIGURE HOSTNAME MACHINE PROD
hostnamectl 
hostnamectl set-hostname ol718cprod
hostnamectl --static 

#CONFIGURE STATIC NETWORK MACHINE STDB
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=none
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=no
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=enp0s3
UUID=49c279da-7065-40f5-b914-176973db2a0a
DEVICE=enp0s3
ONBOOT=yes
IPADDR=192.168.1.131
PREFIX=24
GATEWAY=192.168.1.1
DNS1=8.8.8.8

#CONFIGURE HOSTNAME MACHINE STDB
hostnamectl 
hostnamectl set-hostname ol718cstdb
hostnamectl --static 

#CREATE ORACLE_BASE AND ORACLE_HOME DIRECTORIES BOTH MACHINES
mkdir -p /u01/app/oracle/product/18.3.0/dbhome_1
mkdir -p /u01/oradata
chown -R oracle:oinstall /u01
chmod -R 775 /u01
mkdir -p /u02/app/oracle/oradata/APPSCDB/archivelog
chown oracle:oinstall -R /u02
chmod -R 775 /u02

#CONFIGURE VARIABLES BOTH MACHINES
su - oracle
mkdir /home/oracle/scripts

cat > /home/oracle/scripts/setEnv.sh <<EOF
# Oracle Settings
export TMP=/tmp
export TMPDIR=\$TMP

export ORACLE_HOSTNAME=ora18cprod
export ORACLE_UNQNAME=appscdb
export ORACLE_BASE=/u01/app/oracle
export ORACLE_HOME=\$ORACLE_BASE/product/18.3.0/dbhome_1
export ORA_INVENTORY=/u01/app/oraInventory
export ORACLE_SID=appscdb1

export PATH=/usr/sbin:/usr/local/bin:\$PATH
export PATH=\$ORACLE_HOME/bin:\$PATH

export LD_LIBRARY_PATH=\$ORACLE_HOME/lib:/lib:/usr/lib
export CLASSPATH=\$ORACLE_HOME/jlib:\$ORACLE_HOME/rdbms/jlib
EOF

echo ". /home/oracle/scripts/setEnv.sh" >> /home/oracle/.bash_profile

cat > /home/oracle/scripts/start_all.sh <<EOF
#!/bin/bash
. /home/oracle/scripts/setEnv.sh

export ORAENV_ASK=NO
. oraenv
export ORAENV_ASK=YES

dbstart \$ORACLE_HOME
EOF

cat > /home/oracle/scripts/stop_all.sh <<EOF
#!/bin/bash
. /home/oracle/scripts/setEnv.sh

export ORAENV_ASK=NO
. oraenv
export ORAENV_ASK=YES

dbshut \$ORACLE_HOME
EOF

chown -R oracle:oinstall /home/oracle/scripts
chmod u+x /home/oracle/scripts/*.sh

#DOWNLOAD AND INSTALL ORACLE DATABASE 18.3C BOTH MACHINES
wget https://download.oracle.com/otn/linux/oracle18c/180000/LINUX.X64_183000_db_home.zip?AuthParam=1577574051_dcd3a71670cb8ddcb11b27e39a41738e
mv LINUX.X64_183000_db_home.zip?AuthParam=1577574051_dcd3a71670cb8ddcb11b27e39a41738e $ORACLE_HOME/LINUX.X64_180000_db_home.zip

#UNZIP SFW DATABASE BOTH MACHINES
cd $ORACLE_HOME
unzip -oq LINUX.X64_180000_db_home.zip

#CREATE db_install.rsp INSTALL RESPONSE FILE BOTH MACHINES
vi /home/oracle/db_install18.rsp
oracle.install.responseFileVersion=/oracle/install/rspfmt_dbinstall_response_schema_v18.0.0
oracle.install.option=INSTALL_DB_SWONLY
UNIX_GROUP_NAME=oinstall
INVENTORY_LOCATION=/u01/app/oraInventory
ORACLE_HOME=/u01/app/oracle/product/18.3.0/dbhome_1
ORACLE_BASE=/u01/app/oracle
oracle.install.db.InstallEdition=SE2
oracle.install.db.OSDBA_GROUP=dba
oracle.install.db.OSOPER_GROUP=oinstall
oracle.install.db.OSBACKUPDBA_GROUP=backupdba
oracle.install.db.OSDGDBA_GROUP=dgdba
oracle.install.db.OSKMDBA_GROUP=kmdba
oracle.install.db.OSRACDBA_GROUP=racdba
oracle.install.db.CLUSTER_NODES=
oracle.install.db.config.starterdb.type=GENERAL_PURPOSE
oracle.install.db.config.starterdb.globalDBName=
oracle.install.db.config.starterdb.SID=
oracle.install.db.ConfigureAsContainerDB=false
oracle.install.db.config.PDBName=
oracle.install.db.config.starterdb.characterSet=
oracle.install.db.config.starterdb.memoryOption=false
oracle.install.db.config.starterdb.memoryLimit=
oracle.install.db.config.starterdb.installExampleSchemas=false
oracle.install.db.config.starterdb.password.ALL=
oracle.install.db.config.starterdb.password.SYS=
oracle.install.db.config.starterdb.password.SYSTEM=
oracle.install.db.config.starterdb.password.DBSNMP=
oracle.install.db.config.starterdb.password.PDBADMIN=
oracle.install.db.config.starterdb.managementOption=DEFAULT
oracle.install.db.config.starterdb.omsHost=
oracle.install.db.config.starterdb.omsPort=0
oracle.install.db.config.starterdb.emAdminUser=
oracle.install.db.config.starterdb.emAdminPassword=
oracle.install.db.config.starterdb.enableRecovery=false
oracle.install.db.config.starterdb.storageType=
oracle.install.db.config.starterdb.fileSystemStorage.dataLocation=
oracle.install.db.config.starterdb.fileSystemStorage.recoveryLocation=
oracle.install.db.config.asm.diskGroup=
oracle.install.db.config.asm.ASMSNMPPassword=

cd $ORACLE_HOME 
./runInstaller -silent -responseFile /home/oracle/db_install18.rsp

#RUN COMMAND AS ROOT BOTH MACHINES
	1. /u01/app/oraInventory/orainstRoot.sh
	2. /u01/app/oracle/product/18.3.0/dbhome_1/root.sh

#CREATE dbca.rsp response file BOTH MACHINES
vi /home/oracle/dbca18.rsp
responseFileVersion=/oracle/assistants/rspfmt_dbca_response_schema_v12.2.0
gdbName=appscdb
sid=appscdb1
databaseConfigType=SI
RACOneNodeServiceName=
policyManaged=false
createServerPool=false
serverPoolName=
cardinality=
force=false
pqPoolName=
pqCardinality=
createAsContainerDatabase=true
numberOfPDBs=1
pdbName=appspdb
useLocalUndoForPDBs=true
pdbAdminPassword=
nodelist=
templateName=/u01/app/oracle/product/18.3.0/dbhome_1/assistants/dbca/templates/General_Purpose.dbc
sysPassword=
systemPassword= 
oracleHomeUserPassword=
emConfiguration=
emExpressPort=5500
runCVUChecks=FALSE
dbsnmpPassword=
omsHost=
omsPort=0
emUser=
emPassword=
dvConfiguration=false
dvUserName=
dvUserPassword=
dvAccountManagerName=
dvAccountManagerPassword=
olsConfiguration=false
datafileJarLocation={ORACLE_HOME}/assistants/dbca/templates/
datafileDestination={ORACLE_BASE}/oradata/{DB_UNIQUE_NAME}/
recoveryAreaDestination={ORACLE_BASE}/fast_recovery_area/{DB_UNIQUE_NAME}
storageType=FS
diskGroupName=
asmsnmpPassword=
recoveryGroupName=
characterSet=WE8MSWIN1252
nationalCharacterSet=AL16UTF16
registerWithDirService=false
dirServiceUserName=
dirServicePassword=
walletPassword=
listeners=
variablesFile=
variables=ORACLE_BASE_HOME=/u01/app/oracle/product/18.3.0/dbhome_1,DB_UNIQUE_NAME=appscdb,ORACLE_BASE=/u01/app/oracle,PDB_NAME=,DB_NAME=appscdb,ORACLE_HOME=/u01/app/oracle/product/18.3.0/dbhome_1,SID=appscdb1
initParams=undo_tablespace=UNDOTBS1,sga_target=2047MB,db_block_size=8192BYTES,log_archive_dest_1='LOCATION={ORACLE_BASE}/oradata/archivelog/',nls_language=AMERICAN,dispatchers=(PROTOCOL=TCP) (SERVICE=appscdb1XDB),diagnostic_dest={ORACLE_BASE},control_files=("{ORACLE_BASE}/oradata/{DB_UNIQUE_NAME}/control01.ctl", "{ORACLE_BASE}/fast_recovery_area/{DB_UNIQUE_NAME}/control02.ctl"),remote_login_passwordfile=EXCLUSIVE,audit_file_dest={ORACLE_BASE}/admin/{DB_UNIQUE_NAME}/adump,processes=600,pga_aggregate_target=683MB,nls_territory=AMERICA,db_recovery_file_dest_size=12732MB,open_cursors=300,log_archive_format=%t_%s_%r.dbf,compatible=18.0.0,db_name=appscdb,db_recovery_file_dest={ORACLE_BASE}/fast_recovery_area/{DB_UNIQUE_NAME},audit_trail=db
sampleSchema=false
memoryPercentage=40
databaseType=MULTIPURPOSE
automaticMemoryManagement=false
totalMemory=0

#CREATE netca.rsp response file BOTH MACHINES
vi /home/oracle/netca18.rsp
[GENERAL]
RESPONSEFILE_VERSION="18.0"
CREATE_TYPE="CUSTOM"
INSTALLED_COMPONENTS={"server","net8","javavm"}
INSTALL_TYPE=""typical""
LISTENER_NUMBER=1
LISTENER_NAMES={"LISTENER"}
LISTENER_START=""LISTENER""
NAMING_METHODS={"TNSNAMES","ONAMES","HOSTNAME"}
NSN_NUMBER=1
NSN_NAMES={"EXTPROC_CONNECTION_DATA"}
NSN_SERVICE={"PLSExtProc"}
NSN_SERVICE={"PLSExtProc"}
NSN_PROTOCOLS={"TCP;HOSTNAME;1521"}

#CREATE DATABASE BOTH MACHINES
dbca -silent -createDatabase -responseFile /home/oracle/dbca18.rsp
Enter SYS user password: 

Enter SYSTEM user password: 

Enter PDBADMIN User Password: 

[WARNING] [DBT-06208] The 'SYS' password entered does not conform to the Oracle recommended standards.
   CAUSE: 
a. Oracle recommends that the password entered should be at least 8 characters in length, contain at least 1 uppercase character, 1 lower case character and 1 digit [0-9].
b.The password entered is a keyword that Oracle does not recommend to be used as password
   ACTION: Specify a strong password. If required refer Oracle documentation for guidelines.
[WARNING] [DBT-06208] The 'SYSTEM' password entered does not conform to the Oracle recommended standards.
   CAUSE: 
a. Oracle recommends that the password entered should be at least 8 characters in length, contain at least 1 uppercase character, 1 lower case character and 1 digit [0-9].
b.The password entered is a keyword that Oracle does not recommend to be used as password
   ACTION: Specify a strong password. If required refer Oracle documentation for guidelines.
[WARNING] [DBT-06208] The 'PDBADMIN' password entered does not conform to the Oracle recommended standards.
   CAUSE: 
a. Oracle recommends that the password entered should be at least 8 characters in length, contain at least 1 uppercase character, 1 lower case character and 1 digit [0-9].
b.The password entered is a keyword that Oracle does not recommend to be used as password
   ACTION: Specify a strong password. If required refer Oracle documentation for guidelines.
Prepare for db operation
8% complete
Copying database files
31% complete
Creating and starting Oracle instance
32% complete
36% complete
40% complete
43% complete
46% complete
Completing Database Creation
51% complete
53% complete
54% complete
Creating Pluggable Databases
58% complete
77% complete
Executing Post Configuration Actions
100% complete
Database creation complete. For details check the logfiles at:
 /u01/app/oracle/cfgtoollogs/dbca/appscdb.
Database Information:
Global Database Name:appscdb
System Identifier(SID):appscdb1
Look at the log file "/u01/app/oracle/cfgtoollogs/dbca/appscdb/appscdb.log" for further details.

#IF YOU NEED TO DELETE THE DATABASE EXECUTE
dbca -silent -deleteDatabase -sourceDB appscdb1
Enter SYS user password: 

[WARNING] [DBT-11503] The instance (appscdb1) is not running on the local node. This may result in partial delete of Oracle database.
   CAUSE: A locally running instance is required for complete deletion of Oracle database instance and database files.
   ACTION: Specify a locally running database, or execute DBCA on a node where the database instance is running.
[WARNING] [DBT-19202] The Database Configuration Assistant will delete the Oracle instances and datafiles for your database. All information in the database will be destroyed.
Prepare for db operation
32% complete
Connecting to database
35% complete
39% complete
42% complete
[WARNING] The data files for database with SID "appscdb1" could not be determined because the database could not be started. Do you want to delete the service anyway?
65% complete
Updating network configuration files
68% complete
Deleting instance and datafiles
84% complete
100% complete
Database deletion completed.

#CREATE LISTENER BOTH MACHINES
netca -silent -responsefile /home/oracle/netca18.rsp

Parsing command line arguments:
    Parameter "silent" = true
    Parameter "responsefile" = /home/oracle/netca18.rsp
Done parsing command line arguments.
Oracle Net Services Configuration:
Profile configuration complete.
Oracle Net Services configuration successful. The exit code is 0

#BEFORE INSTALL CONFIGURE AUTOMATIC STARTUP OF DATABASE BOTH MACHINES
vi /etc/oratab
$ORACLE_SID:$ORACLE_HOME:Y

$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

#FROM THIS POINT FOLLOWS THE CONFIGURATION USED TO ENABLE THE REPLICATION OF ONE OR MORE PDBS

#STEP 1 ENABLE ARCHIVELOG MODE ON PROD DATABASE
ssh oracle@192.168.1.130
sqlplus / as sysdba
SQL> archive log list;
Database log mode	       No Archive Mode
Automatic archival	       Disabled
Archive destination	       USE_DB_RECOVERY_FILE_DEST
Oldest online log sequence     2
Current log sequence	       4

SQL> select force_logging from v$database;

FORCE_LOGGING
---------------------------------------
NO

SQL> alter database force logging;

Database altered.

SQL> select force_logging from v$database;

FORCE_LOGGING
---------------------------------------
YES

#IF YOU NEED ENABLE DATAGUARD PHYSICAL STANDBY, ENABLE THESE PARAMETERS:
SQL> alter system set remote_login_passwordfile=exclusive scope=spfile;
SQL> alter system set standby_file_management=auto scope=spfile;
-- SQL> alter system set fal_client=appscdb scope=spfile;
-- SQL> alter system set fal_server=appscdbstdb scope=spfile;
-- SQL> alter system set log_archive_config='dg_config=(appscdb,appscdbs)' scope=spfile;
SQL> alter system set log_archive_dest_1='location=/u02/app/oracle/oradata/APPSCDB/archivelog' scope=spfile;
--SQL> alter system set log_archive_dest_2='service=appscdbs NOAFFIRM ASYNC VALID_FOR=(ONLINE_LOGFILES,PRIMARY_ROLE) DB_UNIQUE_NAME=appscdbs' scope=spfile;
SQL> alter system set log_archive_dest_state_1=enable scope=spfile;
--SQL> alter system set log_archive_dest_state_2=enable scope=spfile;
SQL> alter system set log_archive_format='%t_%s_%r.arc' scope=spfile;
SQL> alter system set log_archive_max_processes=30 scope=spfile;
SQL> alter system set db_file_name_convert='appscdbs','appscdb' scope=spfile;
SQL> alter system set log_file_name_convert='appscdbs','appscdb' scope=spfile;
SQL> alter system set LOG_CHECKPOINT_INTERVAL=300 scope=spfile;

SQL> shu immediate; 
Database closed.
Database dismounted.
ORACLE instance shut down.

SQL> startup mount;
ORACLE instance started.

Total System Global Area 2147481664 bytes
Fixed Size		    8898624 bytes
Variable Size		  687865856 bytes
Database Buffers	 1442840576 bytes
Redo Buffers		    7876608 bytes
Database mounted.
SQL> 

SQL> alter database archivelog;

Database altered.

#THIS FEATURE IS NOT ENABLED FOR ORACLE 18C SE2, IF YOUR DATABASE IS ENTERPRISE EDITION IT IS RECOMMENDED TO ENABLE THIS RESOURCE
SQL> alter database flashback on;
alter database flashback on
*
ERROR at line 1:
ORA-00439: feature not enabled: Flashback Database

SQL> select name,force_logging,log_mode,flashback_on from v$database;

NAME	  FORCE_LOGGING 			  LOG_MODE     FLASHBACK_ON
--------- --------------------------------------- ------------ ------------------
APPSCDB   YES					  ARCHIVELOG   NO

SQL> 

#CREATE STANDBY REDO LOG FILES
SQL> ALTER DATABASE ADD STANDBY LOGFILE ('/u01/app/oracle/oradata/APPSCDB/standby_redo01.log') SIZE 200M;

Database altered.

SQL> ALTER DATABASE ADD STANDBY LOGFILE ('/u01/app/oracle/oradata/APPSCDB/standby_redo02.log') SIZE 200M;

Database altered.

SQL> ALTER DATABASE ADD STANDBY LOGFILE ('/u01/app/oracle/oradata/APPSCDB/standby_redo03.log') SIZE 200M;

Database altered.

SQL> SELECT GROUP#,THREAD#,SEQUENCE#,ARCHIVED,STATUS FROM V$STANDBY_LOG;

    GROUP#    THREAD#  SEQUENCE# ARC STATUS
---------- ---------- ---------- --- ----------
	 4	    0	       0 YES UNASSIGNED
	 5	    0	       0 YES UNASSIGNED
	 6	    0	       0 YES UNASSIGNED

SQL> alter database open;

Database altered.

SQL> alter pluggable database all open;

Pluggable database altered.

SQL> set lines 300 pages 100
SQL> col value for a65
SQL> select name, value from v$parameter where name in ('db_name','db_unique_name','log_archive_config','log_archive_dest_1','log_archive_dest_2','log_archive_dest_state_1','log_archive_dest_state_2','remote_login_passwordfile','log_archive_format','log_archive_max_processes','fal_server','db_file_name_convert','log_file_name_convert','standby_file_management');

NAME										 VALUE
-------------------------------------------------------------------------------- -----------------------------------------------------------------
db_file_name_convert								 appscdbs, appscdb
log_file_name_convert								 appscdbs, appscdb
log_archive_dest_1								 location=/u02/app/oracle/oradata/APPSCDB/archivelog
log_archive_dest_2
log_archive_dest_state_1							 ENABLE
log_archive_dest_state_2							 enable
fal_server
log_archive_config
log_archive_format								 %t_%s_%r.arc
log_archive_max_processes							 30
standby_file_management 							 AUTO
remote_login_passwordfile							 EXCLUSIVE
db_name 									 appscdb
db_unique_name									 appscdb

14 rows selected.

SQL> alter system switch logfile;

System altered.

SQL> archive log list;
Database log mode	       Archive Mode
Automatic archival	       Enabled
Archive destination	       /u02/app/oracle/oradata/APPSCDB/archivelog
Oldest online log sequence     3
Next log sequence to archive   5
Current log sequence	       5

SQL> exit

ls -ltr /u02/app/oracle/oradata/APPSCDB/archivelog/
total 85096
-rw-r-----. 1 oracle oinstall 87135232 Aug 12 14:46 1_4_1048254290.arc

#CONFIGURE NETWORK ON PRODUCTION AND STANDBY

#START LISTENER ON PRODUCTION
lsnrctl status

LSNRCTL for Linux: Version 18.0.0.0.0 - Production on 12-AUG-2020 14:48:59

Copyright (c) 1991, 2018, Oracle.  All rights reserved.

Connecting to (ADDRESS=(PROTOCOL=tcp)(HOST=)(PORT=1521))
TNS-12541: TNS:no listener
 TNS-12560: TNS:protocol adapter error
  TNS-00511: No listener
   Linux Error: 111: Connection refused

vi /u01/app/oracle/product/18.3.0/dbhome_1/network/admin/listener.ora

SID_LIST_LISTENER =
 (SID_LIST =
    (SID_DESC =
      (GLOBAL_DBNAME = appscdb)
      (ORACLE_HOME = /u01/app/oracle/product/18.3.0/dbhome_1)
      (SID_NAME = appscdb1)
    )
    (SID_DESC =
      (GLOBAL_DBNAME = appscdb_DGMGRL)
      (ORACLE_HOME = /u01/app/oracle/product/18.3.0/dbhome_1)
      (SID_NAME = appscdb1)
    )
    (SID_DESC =
      (GLOBAL_DBNAME = appscdbs_DGMGRL)
      (ORACLE_HOME = /u01/app/oracle/product/18.3.0/dbhome_1)
      (SID_NAME = appscdb1)
    )
  )
LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.1.130)(PORT = 1521))
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    )
  )
   
lsnrctl start

LSNRCTL for Linux: Version 18.0.0.0.0 - Production on 12-AUG-2020 15:02:38

Copyright (c) 1991, 2018, Oracle.  All rights reserved.

Starting /u01/app/oracle/product/18.3.0/dbhome_1/bin/tnslsnr: please wait...

TNSLSNR for Linux: Version 18.0.0.0.0 - Production
System parameter file is /u01/app/oracle/product/18.3.0/dbhome_1/network/admin/listener.ora
Log messages written to /u01/app/oracle/diag/tnslsnr/ora18cprod/listener/alert/log.xml
Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.130)(PORT=1521)))
Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=192.168.1.130)(PORT=1521)))
STATUS of the LISTENER
------------------------
Alias                     LISTENER
Version                   TNSLSNR for Linux: Version 18.0.0.0.0 - Production
Start Date                12-AUG-2020 15:02:38
Uptime                    0 days 0 hr. 0 min. 0 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /u01/app/oracle/product/18.3.0/dbhome_1/network/admin/listener.ora
Listener Log File         /u01/app/oracle/diag/tnslsnr/ora18cprod/listener/alert/log.xml
Listening Endpoints Summary...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.130)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))
Services Summary...
Service "appscdb" has 1 instance(s).
  Instance "appscdb1", status UNKNOWN, has 1 handler(s) for this service...
Service "appscdb_DGMGRL" has 1 instance(s).
  Instance "appscdb1", status UNKNOWN, has 1 handler(s) for this service...
Service "appscdbs_DGMGRL" has 1 instance(s).
  Instance "appscdb1", status UNKNOWN, has 1 handler(s) for this service...
The command completed successfully

#START LISTENER ON STANDBY 
lsnrctl status

LSNRCTL for Linux: Version 18.0.0.0.0 - Production on 12-AUG-2020 14:48:59

Copyright (c) 1991, 2018, Oracle.  All rights reserved.

Connecting to (ADDRESS=(PROTOCOL=tcp)(HOST=)(PORT=1521))
TNS-12541: TNS:no listener
 TNS-12560: TNS:protocol adapter error
  TNS-00511: No listener
   Linux Error: 111: Connection refused

vi /u01/app/oracle/product/18.3.0/dbhome_1/network/admin/listener.ora

SID_LIST_LISTENER =
 (SID_LIST =
    (SID_DESC =
      (GLOBAL_DBNAME = appscdb)
      (ORACLE_HOME = /u01/app/oracle/product/18.3.0/dbhome_1)
      (SID_NAME = appscdb1)
    )
 )
LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.1.130)(PORT = 1521))
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    )
  )
   
lsnrctl start

LSNRCTL for Linux: Version 18.0.0.0.0 - Production on 13-AUG-2020 15:51:13

Copyright (c) 1991, 2018, Oracle.  All rights reserved.

Starting /u01/app/oracle/product/18.3.0/dbhome_1/bin/tnslsnr: please wait...

TNSLSNR for Linux: Version 18.0.0.0.0 - Production
System parameter file is /u01/app/oracle/product/18.3.0/dbhome_1/network/admin/listener.ora
Log messages written to /u01/app/oracle/diag/tnslsnr/ol718cprod/listener/alert/log.xml
Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.130)(PORT=1521)))
Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=192.168.1.130)(PORT=1521)))
STATUS of the LISTENER
------------------------
Alias                     LISTENER
Version                   TNSLSNR for Linux: Version 18.0.0.0.0 - Production
Start Date                13-AUG-2020 15:51:14
Uptime                    0 days 0 hr. 0 min. 0 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /u01/app/oracle/product/18.3.0/dbhome_1/network/admin/listener.ora
Listener Log File         /u01/app/oracle/diag/tnslsnr/ol718cprod/listener/alert/log.xml
Listening Endpoints Summary...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.1.130)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))
Services Summary...
Service "appscdb" has 1 instance(s).
  Instance "appscdb1", status UNKNOWN, has 1 handler(s) for this service...
The command completed successfully

#CONFIGURE TNSNAMES.ORA ON BOTH MACHINES
vi /u01/app/oracle/product/18.3.0/dbhome_1/network/admin/tnsnames.ora
appscdb =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.1.130)(PORT = 1521))
    )
    (CONNECT_DATA =
      (SERVICE_NAME = appscdb)
    )
  )

appscdb_clone =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.1.130)(PORT = 1521))
    )
    (CONNECT_DATA =
      (SERVICE_NAME = appscdb)
    )
  )

appscdbs =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.1.131)(PORT = 1521))
    )
    (CONNECT_DATA =
      (SERVICE_NAME = appscdbs)
    )
  )

appscdbs_clone =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.1.131)(PORT = 1521))
    )
    (CONNECT_DATA =
      (SERVICE_NAME = appscdb)
    )
  )


#CHECK NETWORK 
tnsping appscdb

TNS Ping Utility for Linux: Version 18.0.0.0.0 - Production on 12-AUG-2020 15:05:57

Copyright (c) 1997, 2018, Oracle.  All rights reserved.

Used parameter files:
/u01/app/oracle/product/18.3.0/dbhome_1/network/admin/sqlnet.ora

Used TNSNAMES adapter to resolve the alias
Attempting to contact (DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.1.130)(PORT = 1521))) (CONNECT_DATA = (SERVICE_NAME = appscdb)))
OK (0 msec)

$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

#IF THERE IS NO DATABASE IN THE STANDBY ENVIRONMENT DIRECTORIES CAN BE CREATED MANUALLY

#DUPLICATE DATABASE TO STANDBY

mkdir -p /u01/app/oracle/fast_recovery_area/
mkdir -p /u02/app/oracle/oradata/APPSCDB/archivelog
mkdir -p /u01/app/oracle/admin/appscdbs/adump/
mkdir -p /u01/app/oracle/oradata/APPSCDB/appspdb/
mkdir -p /u01/app/oracle/oradata/APPSCDB/pdbseed/

dbca -silent -createDuplicateDB -gdbName appscdb -primaryDBConnectionString "192.168.1.130:1521/appscdb" -sid appscdb1 -createAsStandby -dbUniqueName appscdbs -sysPassword oracle

#CHECK STANDBY DATABASE

sqlplus / as sysdba
SQL> select open_mode, database_role from v$database;
OPEN_MODE  NAME
---------- ---------------------
MOUNTED    PDB$SEED
MOUNTED    APPSPDB

SQL> alter system set log_archive_dest_1='location=/u02/app/oracle/oradata/APPSCDB/archivelog' scope=spfile;

System altered.

SQL> alter system set log_archive_dest_state_1=enable scope=spfile;

System altered.

SQL> alter system set log_archive_format='%t_%s_%r.arc' scope=spfile;

System altered.

#RESTART DATABASE

SQL> shu immediate; 
Database closed.
Database dismounted.
ORACLE instance shut down.
SQL> startup mount;
ORACLE instance started.

Total System Global Area 2147481664 bytes
Fixed Size		    8898624 bytes
Variable Size		  687865856 bytes
Database Buffers	 1442840576 bytes
Redo Buffers		    7876608 bytes
Database mounted.
SQL> 

#EXCHANGE SSH KEYS BETWEEN PRODUCTION AND STANDBY 

ssh-keygen -t rsa
SHA256:hR7VsGAhJZKhGVO3WTXAELVqrsERNVr2Ds2wvPe2l28 oracle@ol718cstdb
The key's randomart image is:
+---[RSA 2048]----+
|  o.+o%*O+=o     |
|   =.O #.= o.    |
|  o o * B o      |
|     . * o       |
|    . + S        |
|   . + . .       |
|    o .   o  .   |
|     o   . .o E  |
|    .     .. o.  |
+----[SHA256]-----+

scp .ssh/id_rsa.pub oracle@192.168.1.131:/home/oracle/ssh/authorized_keys

#SCHEDULE RSYNC ARCHIVE COPY ON PRODUCTION MACHINE

SQL> alter system set archive_lag_target=300 scope=spfile;      

System altered.

#SCHEDULE RSYNC SCRIPT
vi /home/oracle/scripts/rsync_archives.sh
#\!/bin/bash
RESULT=`ps aux | grep rsync | wc -l`
if [ "$RESULT" -le 1 ];then
    echo "rsync copy attempt"
    rsync -av -e 'ssh -p 22' /u02/app/oracle/oradata/APPSCDB/archivelog/ oracle@192.168.1.131:/u02/app/oracle/oradata/APPSCDB/archivelog/
else
    echo "still copying!"
fi

crontab -l
*/1 * * * * /home/oracle/scripts/rsync_archives.sh

#START APPLY PROCESS ON STANDBY MACHINE
vi /home/oracle/scripts/recovery_standby.sh
#\!/bin/bash
. /home/oracle/scripts/setEnv.sh
rman << EOF
connect target /
startup mount;
catalog start with '/u02/app/oracle/oradata/APPSCDB/archivelog/' noprompt;
crosscheck archivelog all;
quit;
EOF

sqlplus / as sysdba <<EOF
alter database recover managed standby database disconnect from session;
alter database recover managed standby database cancel;
SELECT ARCH.THREAD# "Thread", ARCH.SEQUENCE# "Last Sequence Received", APPL.SEQUENCE# "Last Sequence Applied", (ARCH.SEQUENCE# - APPL.SEQUENCE#) "Difference" FROM (SELECT THREAD# ,SEQUENCE# FROM V\$ARCHIVED_LOG WHERE (THREAD#,FIRST_TIME ) IN (SELECT THREAD#,MAX(FIRST_TIME) FROM V\$ARCHIVED_LOG GROUP BY THREAD#)) ARCH, (SELECT THREAD# ,SEQUENCE# FROM V\$LOG_HISTORY WHERE (THREAD#,FIRST_TIME ) IN (SELECT THREAD#,MAX(FIRST_TIME) FROM V\$LOG_HISTORY GROUP BY THREAD#)) APPL WHERE ARCH.THREAD# = APPL.THREAD# ORDER BY 1;
alter database open read only;
alter pluggable database APPSPDB open read only;
exit
EOF

chmod +x /home/oracle/scripts/recovery_standby.sh

crontab -l
*/7 * * * * /home/oracle/scripts/recovery_standby.sh > /home/oracle/scripts/recovery_standby.log 2>&1

#CHECK GAP REPLICATION
cat /home/oracle/scripts/recovery_standby.log
Recovery Manager: Release 18.0.0.0.0 - Production on Fri Aug 14 10:22:50 2020
Version 18.3.0.0.0

Copyright (c) 1982, 2018, Oracle and/or its affiliates.  All rights reserved.

RMAN> 
connected to target database (not started)

RMAN> 
Oracle instance started
database mounted

Total System Global Area    2147481664 bytes

Fixed Size                     8898624 bytes
Variable Size                687865856 bytes
Database Buffers            1442840576 bytes
Redo Buffers                   7876608 bytes

RMAN> 
using target database control file instead of recovery catalog
searching for all files that match the pattern /u02/app/oracle/oradata/APPSCDB/archivelog/

List of Files Unknown to the Database
=====================================
File Name: /u02/app/oracle/oradata/APPSCDB/archivelog/1_27_1048345557.arc
File Name: /u02/app/oracle/oradata/APPSCDB/archivelog/1_26_1048345557.arc
cataloging files...
cataloging done

List of Cataloged Files
=======================
File Name: /u02/app/oracle/oradata/APPSCDB/archivelog/1_27_1048345557.arc
File Name: /u02/app/oracle/oradata/APPSCDB/archivelog/1_26_1048345557.arc

RMAN> 
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=71 device type=DISK
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_4_1048345557.arc RECID=6 STAMP=1048411993
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_5_1048345557.arc RECID=3 STAMP=1048411993
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_6_1048345557.arc RECID=8 STAMP=1048411993
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_7_1048345557.arc RECID=9 STAMP=1048411993
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_8_1048345557.arc RECID=7 STAMP=1048411993
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_9_1048345557.arc RECID=4 STAMP=1048411993
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_10_1048345557.arc RECID=12 STAMP=1048411993
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_11_1048345557.arc RECID=5 STAMP=1048411993
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_12_1048345557.arc RECID=10 STAMP=1048411993
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_13_1048345557.arc RECID=11 STAMP=1048411993
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_14_1048345557.arc RECID=13 STAMP=1048412264
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_15_1048345557.arc RECID=18 STAMP=1048413342
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_16_1048345557.arc RECID=15 STAMP=1048413342
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_17_1048345557.arc RECID=14 STAMP=1048413342
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_18_1048345557.arc RECID=17 STAMP=1048413342
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_19_1048345557.arc RECID=16 STAMP=1048413342
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_20_1048345557.arc RECID=19 STAMP=1048413686
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_21_1048345557.arc RECID=20 STAMP=1048413686
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_22_1048345557.arc RECID=23 STAMP=1048414571
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_23_1048345557.arc RECID=22 STAMP=1048414571
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_24_1048345557.arc RECID=21 STAMP=1048414571
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_25_1048345557.arc RECID=24 STAMP=1048414737
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_26_1048345557.arc RECID=26 STAMP=1048415001
validation succeeded for archived log
archived log file name=/u02/app/oracle/oradata/APPSCDB/archivelog/1_27_1048345557.arc RECID=25 STAMP=1048415001
Crosschecked 24 objects

RMAN> 

Recovery Manager complete.

SQL*Plus: Release 18.0.0.0.0 - Production on Fri Aug 14 10:23:22 2020
Version 18.3.0.0.0

Copyright (c) 1982, 2018, Oracle.  All rights reserved.


Connected to:
Oracle Database 18c Standard Edition 2 Release 18.0.0.0.0 - Production
Version 18.3.0.0.0

SQL> 
Database altered.

SQL> 
Database altered.

SQL> 
    Thread Last Sequence Received Last Sequence Applied Difference
---------- ---------------------- --------------------- ----------
	 1		       27		     27 	 0

SQL> Disconnected from Oracle Database 18c Standard Edition 2 Release 18.0.0.0.0 - Production
Version 18.3.0.0.0

#CONTROLING THE RETENTION OF ARCHIVES RECEIVED ON THE STANDBY MACHINE

rman target /

Recovery Manager: Release 18.0.0.0.0 - Production on Fri Aug 14 10:30:02 2020
Version 18.3.0.0.0

Copyright (c) 1982, 2018, Oracle and/or its affiliates.  All rights reserved.

connected to target database: APPSCDB (DBID=3891823187, not open)

RMAN> CONFIGURE ARCHIVELOG DELETION POLICY TO APPLIED ON ALL STANDBY BACKED UP 1 TIMES TO DISK;

using target database control file instead of recovery catalog
new RMAN configuration parameters:
CONFIGURE ARCHIVELOG DELETION POLICY TO APPLIED ON ALL STANDBY BACKED UP 1 TIMES TO DISK;
new RMAN configuration parameters are successfully stored

RMAN> show all;

RMAN configuration parameters for database with db_unique_name APPSCDBS are:
CONFIGURE RETENTION POLICY TO REDUNDANCY 1; # default
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default
CONFIGURE CONTROLFILE AUTOBACKUP ON; # default
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '%F'; # default
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default
CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO APPLIED ON ALL STANDBY BACKED UP 1 TIMES TO DISK;
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u01/app/oracle/product/18.3.0/dbhome_1/dbs/snapcf_appscdb1.f'; # default

RMAN> list backup summary;


List of Backups
===============
Key     TY LV S Device Type Completion Time #Pieces #Copies Compressed Tag
------- -- -- - ----------- --------------- ------- ------- ---------- ---
1       B  F  A DISK        13-AUG-20       1       1       NO         TAG20200813T155406

RMAN> exit

