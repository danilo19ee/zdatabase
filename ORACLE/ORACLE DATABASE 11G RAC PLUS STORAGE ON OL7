++++++++++++++++++++++++++++++++++++++++++++++++++++++++
+   ORACLE DATABASE 11.2.3 G RAC PLUS STORAGE ON OL7   +
++++++++++++++++++++++++++++++++++++++++++++++++++++++++


#Software

p13390677_112040_platform_1of7.zip (Oracle Database, including Oracle RAC components)
p13390677_112040_platform_2of7.zip (Oracle Database, including Oracle RAC components)
p13390677_112040_platform_3of7.zip (Oracle Grid Infrastructure, includes: Oracle ASM, Oracle Clusterware, Oracle Restart)

Direct Download 
http://app.beg.inf.br/pub/oracle/11/

#create nodes of RAC
New vm >
3 networks interfaces
NAT
HOST-ONLY ADAPTER
INTERNAL NETWORK
1 disk 30gb
/boot 300m - swap 6gb - / 23gb
6gb ram
S.O Redhat EL 7 x86_64
SERVER WITH GUI INSTALATION

#install VirtualBox Guest Additions
yum update kernel* -y
init 6
cd /run/media/root/VBox_GAs_6.0.8
./VBoxLinuxAdditions.run
init 6

#install and configure oracle envoriments
sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config
systemctl stop firewalld
systemctl disable firewalld
systemctl stop chronyd.service
systemctl disable chronyd.service
mv /etc/chrony.conf /etc/chrony.conf.bak
yum install -y oracle-rdbms-server-11gR2-preinstall.x86_64
yum install -y kmod-oracleasm.x86_64 oracleasm-support.x86_64 
yum install -y https://download.oracle.com/otn_software/asmlib/oracleasmlib-2.0.12-1.el7.x86_64.rpm
vi /etc/pam.d/su
vi /etc/pam.d/system-auth
vi /etc/pam.d/sshd
vi /etc/pam.d/login
session required        pam_limits.so
session required        pam_unix.so
vi /etc/security/limits.conf
oracle   soft   nofile    1024
oracle   hard   nofile    65536
oracle   soft   nproc    16384
oracle   hard   nproc    16384
oracle   soft   stack    10240
oracle   hard   stack    32768
oracle   hard   memlock    134217728
oracle   soft   memlock    134217728
*     soft   nofile  1024
*     hard   nofile  65535 

#configure user 
groupadd -g 54321 oinstall
groupadd -g 54322 dba
groupadd -g 54323 oper
groupadd -g 54324 backupdba
groupadd -g 54325 dgdba
groupadd -g 54326 kmdba
groupadd -g 54327 asmdba
groupadd -g 54328 asmoper
groupadd -g 54329 asmadmin
groupadd -g 54330 racdba
userdel oracle
useradd -m -u 54331 -g oinstall -G dba,oper,backupdba,dgdba,kmdba,asmdba,asmadmin,racdba -d /home/oracle -s /bin/bash  oracle
useradd -m -u 54332 -g oinstall -G dba,asmadmin,asmdba,asmoper -d /home/grid -s /bin/bash  grid
id oracle
id grid
passwd oracle
passwd grid
mkdir -p /u01/app/grid
mkdir -p /u01/app/19.3/grid
mkdir -p /u01/app/oracle
mkdir -p /u01/app/oracle/product/19.3
chmod -R 775 /u01
chown -R grid:oinstall /u01
chown -R oracle:oinstall /u01/app/oracle
chown oracle:oinstall -R /home/oracle

#configure static ip
ls -ltr /etc/sysconfig/network-scripts/ifcfg-*
-rw-r--r--. 1 root root 254 Mar 29  2019 /etc/sysconfig/network-scripts/ifcfg-lo
-rw-r--r--. 1 root root 312 Jan 21 10:07 /etc/sysconfig/network-scripts/ifcfg-enp0s3
-rw-r--r--. 1 root root 307 Apr 19 15:24 /etc/sysconfig/network-scripts/ifcfg-Wired_connection_1
-rw-r--r--. 1 root root 307 Apr 19 15:24 /etc/sysconfig/network-scripts/ifcfg-Wired_connection_2

cp /etc/sysconfig/network-scripts/ifcfg-enp0s3 /etc/sysconfig/network-scripts/ifcfg-enp0s3-bkp
vi /etc/sysconfig/network-scripts/ifcfg-enp0s3
#####PUBLIC
TYPE="Ethernet"
PROXY_METHOD="none"
BROWSER_ONLY="no"
BOOTPROTO="none"
DEFROUTE="yes"
IPV4_FAILURE_FATAL="no"
IPV6INIT="no"
IPV6_AUTOCONF="no"
IPV6_DEFROUTE="no"
IPV6_FAILURE_FATAL="no"
IPV6_ADDR_GEN_MODE="stable-privacy"
NAME="enp0s3"
UUID="e117208b-8a1b-4bdd-aa07-4a7aa9650a65"
DEVICE="enp0s3"
ONBOOT="yes"
IPADDR=192.168.1.116
PREFIX=24
GATEWAY=192.168.1.1

cp /etc/sysconfig/network-scripts/ifcfg-Wired_connection_1 /etc/sysconfig/network-scripts/ifcfg-Wired_connection_1-bkp
vi /etc/sysconfig/network-scripts/ifcfg-Wired_connection_1
#####VIP
HWADDR=08:00:27:B4:9B:9F
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=none
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=no
IPV6_AUTOCONF=no
IPV6_DEFROUTE=no
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME="Wired connection 1"
UUID=fb503afb-e01e-4086-a76d-23642c4fa4f6
ONBOOT=yes
IPADDR=192.168.1.118
PREFIX=24
GATEWAY=192.168.1.1

cp /etc/sysconfig/network-scripts/ifcfg-Wired_connection_2 /etc/sysconfig/network-scripts/ifcfg-Wired_connection_2-bkp
vi /etc/sysconfig/network-scripts/ifcfg-Wired_connection_2
#####PRIVATE
HWADDR=08:00:27:AE:32:E6
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=none
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=no
IPV6_AUTOCONF=no
IPV6_DEFROUTE=no
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME="Wired connection 2"
UUID=4c36d486-f66c-4c32-8582-af8f8b111568
ONBOOT=yes
IPADDR=192.168.0.100
PREFIX=24

#check network 
ifconfig
enp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.1.116  netmask 255.255.255.0  broadcast 192.168.1.255
        inet6 fe80::a00:27ff:fe5d:be9f  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:5d:be:9f  txqueuelen 1000  (Ethernet)
        RX packets 97  bytes 13224 (12.9 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 88  bytes 13824 (13.5 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

enp0s8: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.1.118  netmask 255.255.255.0  broadcast 192.168.1.255
        inet6 fe80::a00:27ff:feb4:9b9f  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:b4:9b:9f  txqueuelen 1000  (Ethernet)
        RX packets 2  bytes 1180 (1.1 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 44  bytes 6456 (6.3 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

enp0s9: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.0.100  netmask 255.255.255.0  broadcast 192.168.0.255
        inet6 fe80::a00:27ff:feae:32e6  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:ae:32:e6  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 44  bytes 7273 (7.1 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

#set hostname
hostnamectl 
hostnamectl set-hostname oraclerac11gn1
hostnamectl --static 

#configure /etc/hosts
vi /etc/hosts
# bridge
# Public Network - (enp0s3)
192.168.1.116 oraclerac11gn1.appsdba.info oraclerac11gn1
192.168.1.117 oraclerac11gn2.appsdba.info oraclerac11gn2

# Internal Network
# Private Interconnect - (enp0s9)
192.168.0.100 oraclerac11gn1-priv.appsdba.info oraclerac11gn1-priv
192.168.0.101 oraclerac11gn2-priv.appsdba.info oraclerac11gn2-priv

# Public Virtual IP (VIP) addresses for - (enp0s8)
192.168.1.118 oraclerac11gn1-vip.appsdba.info oraclerac11gn1-vip
192.168.1.119 oraclerac11gn2-vip.appsdba.info oraclerac11gn2-vip

# Scan IPÂ´s
192.168.1.120 oraclerac11g-scan.appsdba.info oraclerac11g-scan
192.168.1.121 oraclerac11g-scan.appsdba.info oraclerac11g-scan

#configure resolve name
vi /etc/racdns
192.168.1.120 oraclerac11g-scan.appsdba.info oraclerac11g-scan
192.168.1.121 oraclerac11g-scan.appsdba.info oraclerac11g-scan
vi /etc/dnsmasq.conf | grep addn-hosts
addn-hosts=/etc/racdns

vi /etc/resolv.conf
nameserver 127.0.0.1
search appsdba.info
nameserver 192.168.1.1

chattr +i /etc/resolv.conf
systemctl start dnsmasq
systemctl enable dnsmasq

#check resolve name

nslookup oraclerac11g-scan
Server:         127.0.0.1
Address:        127.0.0.1#53

Name:   oraclerac11g-scan.appsdba.info
Address: 192.168.1.120
Name:   oraclerac11g-scan.appsdba.info
Address: 192.168.1.121
Name:   oraclerac11g-scan.appsdba.info
Address: 192.168.1.121
Name:   oraclerac11g-scan.appsdba.info
Address: 192.168.1.120

nslookup oraclerac11gn1
Server:         127.0.0.1
Address:        127.0.0.1#53

Name:   oraclerac11gn1.appsdba.info
Address: 192.168.1.116

nslookup oraclerac11gn1-priv
Server:         127.0.0.1
Address:        127.0.0.1#53

Name:   oraclerac11gn1-priv.appsdba.info

#add disks to create asm
sdb     10GB    Shareable disk
sdc     10GB    Shareable disk
sdd     10GB    Shareable disk

fdisk -l
Disk /dev/sdd: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

Disk /dev/sdc: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

#partition the disks
fdisk /dev/sdd
Welcome to fdisk (util-linux 2.23.2).

Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table
Building a new DOS disklabel with disk identifier 0x6db98611.

Command (m for help): n
Partition type:
   p   primary (0 primary, 0 extended, 4 free)
   e   extended
Select (default p): p
Partition number (1-4, default 1): 1
First sector (2048-20971519, default 2048):
Using default value 2048
Last sector, +sectors or +size{K,M,G} (2048-20971519, default 20971519):
Using default value 20971519
Partition 1 of type Linux and of size 10 GiB is set

Command (m for help): w
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.

#configure user envoriments
vi /home/grid/.bash_profile
PATH=$PATH:$HOME/.local/bin:$HOME/bin
export ORACLE_SID=+ASM1
export ORACLE_BASE=/u01/app/grid
export ORACLE_HOME=/u01/app/11.2/grid
export PATH=$ORACLE_HOME/bin:$ORACLE_HOME/OPatch:$PATH
umask 22

vi /home/oracle/.bash_profile
PATH=$PATH:$HOME/.local/bin:$HOME/bin
export ORACLE_SID=oradbc1
export ORACLE_BASE=/u01/app/oracle
export ORACLE_HOME=$ORACLE_BASE/product/11.2/dbhome_1
export PATH=$ORACLE_HOME/bin:$ORACLE_HOME/OPatch:$PATH
umask 22

vi /root/.bash_profile
PATH=$PATH:$HOME/bin
export ORACLE_HOME=/u01/app/11.2/grid
export PATH=$ORACLE_HOME/bin:$ORACLE_HOME/OPatch:$PATH

#configure asm disks
source /root/.bash_profile
oracleasm configure -i
Configuring the Oracle ASM library driver.

This will configure the on-boot properties of the Oracle ASM library
driver.  The following questions will determine whether the driver is
loaded on boot and what permissions it will have.  The current values
will be shown in brackets ('[]').  Hitting <ENTER> without typing an
answer will keep that current value.  Ctrl-C will abort.

Default user to own the driver interface []: oracle
Default group to own the driver interface []: oinstall
Start Oracle ASM library driver on boot (y/n) [n]: y
Scan for Oracle ASM disks on boot (y/n) [y]: y
Writing Oracle ASM library driver configuration: done

#identify uid disks
/usr/lib/udev/scsi_id -g -u -d /dev/sdb1
1ATA_VBOX_HARDDISK_VB40355d90-daab0c3a
/usr/lib/udev/scsi_id -g -u -d /dev/sdc1
1ATA_VBOX_HARDDISK_VBf8a04d01-017a7000
/usr/lib/udev/scsi_id -g -u -d /dev/sdd1
1ATA_VBOX_HARDDISK_VB17fcea21-810ea673

#configure rules file for create symbolic link
vi /etc/udev/rules.d/99-oracle-asmdevices.rules
KERNEL=="sd?1", SUBSYSTEM=="block", PROGRAM=="/usr/lib/udev/scsi_id -g -u -d /dev/$parent", RESULT=="1ATA_VBOX_HARDDISK_VB40355d90-daab0c3a", SYMLINK+="asm-disk1", OWNER="grid", GROUP="asmadmin", MODE="0660"
KERNEL=="sd?1", SUBSYSTEM=="block", PROGRAM=="/usr/lib/udev/scsi_id -g -u -d /dev/$parent", RESULT=="1ATA_VBOX_HARDDISK_VBf8a04d01-017a7000", SYMLINK+="asm-disk2", OWNER="grid", GROUP="asmadmin", MODE="0660"
KERNEL=="sd?1", SUBSYSTEM=="block", PROGRAM=="/usr/lib/udev/scsi_id -g -u -d /dev/$parent", RESULT=="1ATA_VBOX_HARDDISK_VB17fcea21-810ea673", SYMLINK+="asm-disk3", OWNER="grid", GROUP="asmadmin", MODE="0660"

#check configuration of device
udevadm test /block/sdb/sdb1
udevadm test /block/sdc/sdc1
udevadm test /block/sdd/sdd1
udevadm control --reload-rules
/sbin/udevadm trigger

#validade configuration
ls -ltr /dev/asm-disk*
lrwxrwxrwx 1 root root 4 Apr 19 17:56 /dev/asm-disk1 -> sdb1
lrwxrwxrwx 1 root root 4 Apr 19 17:56 /dev/asm-disk2 -> sdc1
lrwxrwxrwx 1 root root 4 Apr 19 17:56 /dev/asm-disk3 -> sdd1

#shutdown node1 and clone to node2
#up two node machines
#change personal configuration like variables, hostname, ips and uid disks in rules file

#ssh key exchange
su - root -c "ssh-keygen -t rsa"
su - oracle -c "ssh-keygen -t rsa"
su - grid -c "ssh-keygen -t rsa"

su - root -c "cat /root/.ssh/id_rsa.pub > /root/.ssh/authorized_keys"
su - oracle -c "cat /home/oracle/.ssh/id_rsa.pub > /home/oracle/.ssh/authorized_keys"
su - grid -c "cat /home/grid/.ssh/id_rsa.pub > /home/grid/.ssh/authorized_keys"
chmod 600 /root/.ssh/authorized_keys
chmod 600 /home/oracle/.ssh/authorized_keys
chmod 600 /home/grid/.ssh/authorized_keys

* go to node 2 and copy the contents of the id_rsa.pub files from the respective root, grid, oracle users to authorized_keys on node 1

#copy software

#validate all configuration (run runcluvfy.sh)
su - grid
cd /u01/app/11.2/grid/

#change CV_ASSUME_DISTID
vi /u01/app/11.2/grid/stage/cvu/cv/admin/cvu_config
CV_ASSUME_DISTID=OEL7

#run pre install check
./runcluvfy.sh stage -pre crsinst -n oraclerac11gn1,oraclerac11gn2 -fixup -verbose













